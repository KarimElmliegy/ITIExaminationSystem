<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Examination System - Complete Stored Procedures Documentation (40
      Procedures)
    </title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css"
    />
    <style>
      :root {
        --primary-color: #1a1a2e;
        --secondary-color: #0ea5e9;
        --accent-color: #f43f5e;
        --light-color: #f8fafc;
        --dark-color: #0f172a;
        --success-color: #10b981;
        --warning-color: #f59e0b;
        --admin-color: #8b5cf6;
        --student-color: #3b82f6;
        --instructor-color: #10b981;
        --auth-color: #f97316;
        --exam-color: #ef4444;
        --sidebar-width: 280px;
        --gradient-primary: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        --gradient-secondary: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 100%);
        --gradient-accent: linear-gradient(135deg, #f43f5e 0%, #ec4899 100%);
        --gradient-admin: linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%);
        --gradient-student: linear-gradient(135deg, #3b82f6 0%, #0ea5e9 100%);
        --gradient-instructor: linear-gradient(
          135deg,
          #10b981 0%,
          #22c55e 100%
        );
        --gradient-auth: linear-gradient(135deg, #f97316 0%, #f59e0b 100%);
        --gradient-exam: linear-gradient(135deg, #ef4444 0%, #f43f5e 100%);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        color: #e2e8f0;
        line-height: 1.6;
        min-height: 100vh;
      }

      .container {
        display: flex;
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
      }

      /* Animated Background */
      .container::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background:
          radial-gradient(
            circle at 20% 50%,
            rgba(56, 189, 248, 0.1) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 20%,
            rgba(139, 92, 246, 0.1) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 40% 80%,
            rgba(239, 68, 68, 0.1) 0%,
            transparent 50%
          );
        z-index: -1;
        animation: float 20s ease-in-out infinite;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px) rotate(0deg);
        }
        50% {
          transform: translateY(-20px) rotate(180deg);
        }
      }

      /* Sidebar Styles */
      .sidebar {
        width: var(--sidebar-width);
        background: var(--gradient-primary);
        color: white;
        position: fixed;
        height: 100vh;
        overflow-y: auto;
        padding: 20px 0;
        box-shadow:
          0 10px 30px rgba(0, 0, 0, 0.3),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        z-index: 100;
        backdrop-filter: blur(10px);
        border-right: 1px solid rgba(255, 255, 255, 0.1);
        transform: translateX(0);
        transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .sidebar-header {
        padding: 0 20px 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        background: linear-gradient(
          90deg,
          transparent,
          rgba(14, 165, 233, 0.1),
          transparent
        );
        margin-bottom: 20px;
      }

      .sidebar-header h2 {
        font-size: 1.8rem;
        margin-bottom: 8px;
        color: white;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        background: linear-gradient(90deg, #fff, #0ea5e9);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        animation: textShine 3s ease-in-out infinite alternate;
      }

      @keyframes textShine {
        0% {
          background-position: 0% 50%;
        }
        100% {
          background-position: 100% 50%;
        }
      }

      .sidebar-header p {
        font-size: 0.9rem;
        opacity: 0.8;
        color: #cbd5e1;
      }

      .search-box {
        padding: 20px;
        padding-bottom: 10px;
        position: relative;
      }

      .search-box input {
        width: 100%;
        padding: 12px 45px 12px 15px;
        border-radius: 10px;
        border: 2px solid transparent;
        font-size: 0.95rem;
        background: rgba(15, 23, 42, 0.8);
        color: white;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .search-box input:focus {
        outline: none;
        border-color: #0ea5e9;
        box-shadow:
          0 0 0 3px rgba(14, 165, 233, 0.3),
          0 10px 20px rgba(14, 165, 233, 0.2);
        transform: translateY(-2px);
      }

      .search-box input::placeholder {
        color: #94a3b8;
      }

      .search-box::after {
        content: "üîç";
        position: absolute;
        right: 35px;
        top: 50%;
        transform: translateY(-50%);
        opacity: 0.6;
        transition: opacity 0.3s;
      }

      .search-box:focus-within::after {
        opacity: 1;
      }

      .category-filter {
        padding: 10px 20px;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .category-btn {
        padding: 8px 15px;
        background: rgba(30, 41, 59, 0.8);
        border-radius: 10px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid transparent;
        position: relative;
        overflow: hidden;
        z-index: 1;
      }

      .category-btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, currentColor 0%, transparent 100%);
        opacity: 0;
        transition: opacity 0.3s;
        z-index: -1;
      }

      .category-btn.active {
        background: rgba(30, 41, 59, 0.95);
        font-weight: bold;
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      }

      .category-btn.active::before {
        opacity: 0.1;
      }

      .category-btn:hover:not(.active) {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        border-color: rgba(255, 255, 255, 0.2);
      }

      .category-btn.admin {
        border-left: 4px solid var(--admin-color);
        color: #c4b5fd;
      }
      .category-btn.student {
        border-left: 4px solid var(--student-color);
        color: #93c5fd;
      }
      .category-btn.instructor {
        border-left: 4px solid var(--instructor-color);
        color: #86efac;
      }
      .category-btn.auth {
        border-left: 4px solid var(--auth-color);
        color: #fdba74;
      }
      .category-btn.exam {
        border-left: 4px solid var(--exam-color);
        color: #fca5a5;
      }

      .procedure-list {
        padding: 10px 0;
      }

      .procedure-item {
        padding: 15px 20px;
        border-left: 4px solid transparent;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        font-size: 0.9rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        position: relative;
        overflow: hidden;
        backdrop-filter: blur(5px);
      }

      .procedure-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.1),
          transparent
        );
        transition: left 0.6s;
      }

      .procedure-item:hover::before {
        left: 100%;
      }

      .procedure-item:hover {
        background: rgba(255, 255, 255, 0.05);
        padding-left: 25px;
        transform: translateX(5px);
      }

      .procedure-item.active {
        background: linear-gradient(
          90deg,
          rgba(14, 165, 233, 0.2) 0%,
          transparent 100%
        );
        border-left-color: var(--secondary-color);
        font-weight: bold;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          box-shadow: 0 0 0 0 rgba(14, 165, 233, 0.4);
        }
        50% {
          box-shadow: 0 0 0 8px rgba(14, 165, 233, 0);
        }
      }

      .procedure-id {
        display: inline-block;
        background: rgba(255, 255, 255, 0.1);
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 0.8rem;
        margin-right: 10px;
        font-weight: bold;
        color: #0ea5e9;
        transition: all 0.3s;
      }

      .procedure-item:hover .procedure-id {
        background: rgba(14, 165, 233, 0.3);
        transform: scale(1.1);
      }

      .procedure-name {
        font-weight: 500;
        color: #e2e8f0;
      }

      /* Main Content Styles */
      .main-content {
        flex: 1;
        margin-left: var(--sidebar-width);
        padding: 30px 50px;
        max-width: calc(100% - var(--sidebar-width));
        background: transparent;
        position: relative;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 40px;
        padding-bottom: 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
      }

      .header::after {
        content: "";
        position: absolute;
        bottom: -1px;
        left: 0;
        width: 100px;
        height: 3px;
        background: var(--gradient-secondary);
        border-radius: 3px;
        animation: slideIn 1s ease-out;
      }

      @keyframes slideIn {
        from {
          width: 0;
        }
        to {
          width: 100px;
        }
      }

      .header h1 {
        background: linear-gradient(90deg, #fff, #0ea5e9);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        font-size: 2.5rem;
        text-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        animation: headerGlow 3s ease-in-out infinite alternate;
      }

      @keyframes headerGlow {
        0% {
          filter: drop-shadow(0 0 5px rgba(14, 165, 233, 0.5));
        }
        100% {
          filter: drop-shadow(0 0 20px rgba(14, 165, 233, 0.8));
        }
      }

      .header p {
        color: #94a3b8;
        font-size: 1.1rem;
        margin-top: 5px;
      }

      .header-info {
        display: flex;
        gap: 25px;
        font-size: 0.95rem;
        color: #cbd5e1;
      }

      .header-info div {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 15px;
        background: rgba(30, 41, 59, 0.8);
        border-radius: 10px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s;
      }

      .header-info div:hover {
        transform: translateY(-2px);
        border-color: rgba(14, 165, 233, 0.5);
        box-shadow: 0 8px 16px rgba(14, 165, 233, 0.2);
      }

      .header-info i {
        color: #0ea5e9;
      }

      .stats {
        display: flex;
        gap: 25px;
        margin-bottom: 40px;
        perspective: 1000px;
      }

      .stat-card {
        flex: 1;
        background: linear-gradient(
          145deg,
          rgba(30, 41, 59, 0.9),
          rgba(15, 23, 42, 0.9)
        );
        padding: 25px;
        border-radius: 16px;
        box-shadow:
          0 10px 30px rgba(0, 0, 0, 0.3),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        text-align: center;
        transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
        overflow: hidden;
        cursor: pointer;
        transform-style: preserve-3d;
      }

      .stat-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          45deg,
          transparent 30%,
          rgba(255, 255, 255, 0.05) 50%,
          transparent 70%
        );
        transform: translateX(-100%);
      }

      .stat-card:hover::before {
        animation: shine 1s;
      }

      @keyframes shine {
        100% {
          transform: translateX(100%);
        }
      }

      .stat-card:hover {
        transform: translateY(-10px) rotateX(5deg) rotateY(5deg);
        box-shadow:
          0 20px 40px rgba(0, 0, 0, 0.4),
          0 0 0 1px rgba(255, 255, 255, 0.1);
      }

      .stat-card.admin {
        border-top: 4px solid var(--admin-color);
      }
      .stat-card.student {
        border-top: 4px solid var(--student-color);
      }
      .stat-card.instructor {
        border-top: 4px solid var(--instructor-color);
      }
      .stat-card.auth {
        border-top: 4px solid var(--auth-color);
      }
      .stat-card.exam {
        border-top: 4px solid var(--exam-color);
      }

      .stat-card h3 {
        font-size: 3rem;
        background: linear-gradient(90deg, #fff, currentColor);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        margin-bottom: 10px;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        animation: countUp 1s ease-out;
      }

      @keyframes countUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .stat-card p {
        color: #cbd5e1;
        font-weight: 500;
        font-size: 1.1rem;
        letter-spacing: 0.5px;
      }

      .procedure-section {
        background: linear-gradient(
          145deg,
          rgba(30, 41, 59, 0.95),
          rgba(15, 23, 42, 0.95)
        );
        border-radius: 16px;
        padding: 35px;
        margin-bottom: 35px;
        box-shadow:
          0 15px 35px rgba(0, 0, 0, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        display: none;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
        overflow: hidden;
      }

      .procedure-section::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: var(--gradient-secondary);
      }

      .procedure-section.active {
        display: block;
        animation: slideUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .procedure-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
      }

      .procedure-header::after {
        content: "";
        position: absolute;
        bottom: -1px;
        left: 0;
        width: 150px;
        height: 2px;
        background: var(--gradient-secondary);
      }

      .procedure-title h2 {
        background: linear-gradient(90deg, #fff, #0ea5e9);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        font-size: 2.2rem;
        margin-bottom: 10px;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      .procedure-title p {
        color: #94a3b8;
        font-size: 1.1rem;
        margin-bottom: 15px;
      }

      .procedure-meta {
        display: flex;
        gap: 20px;
        margin-top: 15px;
      }

      .meta-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.95rem;
        color: #cbd5e1;
        padding: 8px 15px;
        background: rgba(15, 23, 42, 0.8);
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s;
      }

      .meta-item:hover {
        transform: translateY(-2px);
        border-color: rgba(14, 165, 233, 0.5);
        box-shadow: 0 4px 12px rgba(14, 165, 233, 0.2);
      }

      .meta-item i {
        color: #0ea5e9;
      }

      .procedure-category {
        padding: 6px 18px;
        border-radius: 20px;
        font-weight: bold;
        font-size: 0.95rem;
        color: white;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        transition: all 0.3s;
      }

      .procedure-category.admin {
        background: var(--gradient-admin);
      }
      .procedure-category.student {
        background: var(--gradient-student);
      }
      .procedure-category.instructor {
        background: var(--gradient-instructor);
      }
      .procedure-category.auth {
        background: var(--gradient-auth);
      }
      .procedure-category.exam {
        background: var(--gradient-exam);
      }

      .procedure-category:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      }

      .procedure-content {
        margin-top: 30px;
        animation: fadeIn 0.8s ease-out 0.3s both;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .content-section {
        margin-bottom: 30px;
        padding: 20px;
        background: rgba(15, 23, 42, 0.5);
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        transition: all 0.3s;
      }

      .content-section:hover {
        border-color: rgba(14, 165, 233, 0.3);
        box-shadow: 0 8px 24px rgba(14, 165, 233, 0.1);
        transform: translateY(-2px);
      }

      .content-section h3 {
        background: linear-gradient(90deg, #fff, #0ea5e9);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        margin-bottom: 15px;
        padding-bottom: 8px;
        border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
        font-size: 1.5rem;
      }

      .content-section p,
      .content-section ul {
        margin-bottom: 15px;
        color: #cbd5e1;
        line-height: 1.7;
      }

      .content-section ul {
        padding-left: 25px;
      }

      .content-section li {
        margin-bottom: 8px;
        position: relative;
        padding-left: 10px;
      }

      .content-section li::before {
        content: "‚ñ∂";
        position: absolute;
        left: -15px;
        color: #0ea5e9;
        font-size: 0.8em;
        animation: bounce 2s infinite;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateX(0);
        }
        50% {
          transform: translateX(3px);
        }
      }

      .code-block {
        background: linear-gradient(145deg, #1e293b, #0f172a);
        border-radius: 12px;
        overflow: hidden;
        margin: 20px 0;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        transition: all 0.3s;
      }

      .code-block:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
      }

      .code-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: linear-gradient(90deg, #1e293b, #334155);
        color: #cbd5e1;
        font-size: 0.9rem;
        font-family: "Courier New", monospace;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .copy-btn {
        background: linear-gradient(135deg, #0ea5e9, #3b82f6);
        border: none;
        color: white;
        padding: 8px 16px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.85rem;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 6px;
        font-weight: 500;
        letter-spacing: 0.5px;
      }

      .copy-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(14, 165, 233, 0.4);
        background: linear-gradient(135deg, #3b82f6, #0ea5e9);
      }

      .copy-btn:active {
        transform: translateY(0);
      }

      pre {
        margin: 0;
        padding: 25px;
        overflow-x: auto;
      }

      code {
        font-family: "JetBrains Mono", "Courier New", monospace;
        font-size: 0.95rem;
      }

      .hljs {
        background: transparent !important;
        padding: 0 !important;
      }

      .parameters-table,
      .returns-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        margin: 20px 0;
        background: rgba(15, 23, 42, 0.8);
        border-radius: 12px;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .parameters-table th,
      .returns-table th {
        background: linear-gradient(90deg, #1e293b, #334155);
        color: white;
        padding: 18px;
        text-align: left;
        font-weight: 600;
        letter-spacing: 0.5px;
        border-bottom: 2px solid rgba(14, 165, 233, 0.5);
      }

      .parameters-table td,
      .returns-table td {
        padding: 15px 18px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        color: #cbd5e1;
        transition: all 0.3s;
      }

      .parameters-table tr:hover td,
      .returns-table tr:hover td {
        background: rgba(14, 165, 233, 0.1);
        color: #fff;
      }

      .parameters-table tr:last-child td,
      .returns-table tr:last-child td {
        border-bottom: none;
      }

      .empty-state {
        text-align: center;
        padding: 80px 30px;
        color: #94a3b8;
        background: rgba(15, 23, 42, 0.5);
        border-radius: 16px;
        border: 2px dashed rgba(255, 255, 255, 0.1);
        animation: pulse 2s infinite;
      }

      .empty-state i {
        font-size: 4rem;
        margin-bottom: 25px;
        color: #475569;
        animation: float 3s ease-in-out infinite;
      }

      .mobile-toggle {
        display: none;
        position: fixed;
        top: 25px;
        right: 25px;
        z-index: 101;
        background: linear-gradient(135deg, #0ea5e9, #3b82f6);
        color: white;
        border: none;
        border-radius: 12px;
        width: 60px;
        height: 60px;
        font-size: 1.8rem;
        cursor: pointer;
        box-shadow: 0 8px 25px rgba(14, 165, 233, 0.4);
        transition: all 0.3s;
      }

      .mobile-toggle:hover {
        transform: scale(1.1) rotate(90deg);
        box-shadow: 0 12px 30px rgba(14, 165, 233, 0.6);
      }

      /* Quick Navigation */
      .quick-nav {
        background: linear-gradient(
          145deg,
          rgba(30, 41, 59, 0.95),
          rgba(15, 23, 42, 0.95)
        );
        border-radius: 16px;
        padding: 25px;
        margin-bottom: 40px;
        border-left: 5px solid #0ea5e9;
        box-shadow:
          0 10px 30px rgba(0, 0, 0, 0.3),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        animation: slideInLeft 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      }

      @keyframes slideInLeft {
        from {
          opacity: 0;
          transform: translateX(-30px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .quick-nav h3 {
        margin-bottom: 20px;
        color: #fff;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .quick-nav h3 i {
        color: #0ea5e9;
        animation: spin 10s linear infinite;
      }

      @keyframes spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      .nav-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 20px;
      }

      .nav-item {
        background: linear-gradient(
          145deg,
          rgba(30, 41, 59, 0.8),
          rgba(15, 23, 42, 0.8)
        );
        padding: 18px 20px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        font-size: 0.95rem;
        border-left: 4px solid #ddd;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(5px);
        position: relative;
        overflow: hidden;
      }

      .nav-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          45deg,
          transparent 30%,
          rgba(255, 255, 255, 0.05) 50%,
          transparent 70%
        );
        transform: translateX(-100%);
      }

      .nav-item:hover::before {
        animation: shine 1s;
      }

      .nav-item:hover {
        transform: translateY(-5px) scale(1.02);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
        border-color: rgba(255, 255, 255, 0.2);
      }

      .nav-item.admin {
        border-left-color: var(--admin-color);
        background: linear-gradient(
          145deg,
          rgba(139, 92, 246, 0.1),
          rgba(15, 23, 42, 0.8)
        );
      }
      .nav-item.student {
        border-left-color: var(--student-color);
        background: linear-gradient(
          145deg,
          rgba(59, 130, 246, 0.1),
          rgba(15, 23, 42, 0.8)
        );
      }
      .nav-item.instructor {
        border-left-color: var(--instructor-color);
        background: linear-gradient(
          145deg,
          rgba(16, 185, 129, 0.1),
          rgba(15, 23, 42, 0.8)
        );
      }
      .nav-item.auth {
        border-left-color: var(--auth-color);
        background: linear-gradient(
          145deg,
          rgba(249, 115, 22, 0.1),
          rgba(15, 23, 42, 0.8)
        );
      }
      .nav-item.exam {
        border-left-color: var(--exam-color);
        background: linear-gradient(
          145deg,
          rgba(239, 68, 68, 0.1),
          rgba(15, 23, 42, 0.8)
        );
      }

      .nav-item-id {
        font-weight: bold;
        color: #0ea5e9;
        margin-right: 10px;
        font-size: 1.1rem;
      }

      .nav-item strong {
        color: #fff;
        font-size: 1.1rem;
        display: block;
        margin-bottom: 5px;
      }

      .nav-item small {
        color: #94a3b8;
        font-size: 0.9rem;
        line-height: 1.5;
      }

      /* Scrollbar Styling */
      ::-webkit-scrollbar {
        width: 10px;
        height: 10px;
      }

      ::-webkit-scrollbar-track {
        background: rgba(15, 23, 42, 0.8);
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #0ea5e9, #3b82f6);
        border-radius: 10px;
        border: 2px solid rgba(15, 23, 42, 0.8);
      }

      ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #3b82f6, #0ea5e9);
      }

      /* Responsive Styles */
      @media (max-width: 1024px) {
        .sidebar {
          transform: translateX(-100%);
          transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sidebar.open {
          transform: translateX(0);
          box-shadow: 20px 0 40px rgba(0, 0, 0, 0.5);
        }

        .main-content {
          margin-left: 0;
          max-width: 100%;
          padding: 25px;
        }

        .mobile-toggle {
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .header {
          flex-direction: column;
          align-items: flex-start;
          gap: 20px;
          padding-top: 80px;
        }

        .header-info {
          flex-direction: column;
          gap: 10px;
          width: 100%;
        }

        .header-info div {
          width: 100%;
          justify-content: center;
        }
      }

      @media (max-width: 768px) {
        .main-content {
          padding: 20px;
        }

        .stats {
          flex-direction: column;
        }

        .procedure-header {
          flex-direction: column;
          gap: 20px;
        }

        .procedure-meta {
          flex-wrap: wrap;
        }

        .parameters-table,
        .returns-table {
          display: block;
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
        }

        .nav-grid {
          grid-template-columns: 1fr;
        }

        .header h1 {
          font-size: 2rem;
        }

        .procedure-title h2 {
          font-size: 1.8rem;
        }
      }

      @media (max-width: 480px) {
        .stat-card h3 {
          font-size: 2.5rem;
        }

        .procedure-section {
          padding: 20px;
        }

        .content-section {
          padding: 15px;
        }

        .code-header {
          flex-direction: column;
          gap: 10px;
          align-items: flex-start;
        }
      }

      /* Loading Animation */
      .loading {
        display: inline-block;
        width: 50px;
        height: 50px;
        border: 3px solid rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        border-top-color: #0ea5e9;
        animation: spin 1s ease-in-out infinite;
      }

      /* Floating Elements */
      .floating {
        animation: floating 6s ease-in-out infinite;
      }

      @keyframes floating {
        0%,
        100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-20px);
        }
      }

      /* Glow Effects */
      .glow {
        position: relative;
      }

      .glow::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        border-radius: inherit;
        box-shadow: 0 0 20px currentColor;
        opacity: 0;
        transition: opacity 0.3s;
      }

      .glow:hover::after {
        opacity: 0.5;
      }
    </style>
  </head>
  <body>
    <!-- Rest of the HTML remains exactly the same -->
    <div class="container">
      <!-- Mobile Toggle Button -->
      <button class="mobile-toggle" id="mobileToggle">
        <i class="fas fa-bars"></i>
      </button>

      <!-- Sidebar Navigation -->
      <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <h2>Exam System DB</h2>
          <p>Complete Stored Procedures Documentation</p>
        </div>

        <div class="search-box">
          <input
            type="text"
            id="searchInput"
            placeholder="Search procedures..."
          />
        </div>

        <div class="category-filter">
          <div class="category-btn active" data-category="all">All (40)</div>
          <div class="category-btn admin" data-category="admin">Admin (20)</div>
          <div class="category-btn student" data-category="student">
            Student (5)
          </div>
          <div class="category-btn instructor" data-category="instructor">
            Instructor (11)
          </div>
          <div class="category-btn auth" data-category="auth">Auth (1)</div>
          <div class="category-btn exam" data-category="exam">Exam (3)</div>
        </div>

        <div class="procedure-list" id="procedureList">
          <!-- Procedure list will be populated by JavaScript -->
        </div>
      </div>

      <!-- Main Content Area -->
      <div class="main-content">
        <div class="header">
          <div>
            <h1>Examination System Documentation</h1>
            <p>
              Complete documentation of all 40 stored procedures for Admin,
              Student, and Instructor roles
            </p>
          </div>
          <div class="header-info">
            <div>
              <i class="fas fa-database"></i> Database: ExaminationSystemContext
            </div>
            <div><i class="fas fa-calendar"></i> Created: 2026</div>
            <div><i class="fas fa-file-code"></i> Total Procedures: 40</div>
          </div>
        </div>

        <!-- Statistics Cards -->
        <div class="stats">
          <div class="stat-card admin">
            <h3>20</h3>
            <p>Admin Procedures</p>
          </div>
          <div class="stat-card student">
            <h3>5</h3>
            <p>Student Procedures</p>
          </div>
          <div class="stat-card instructor">
            <h3>11</h3>
            <p>Instructor Procedures</p>
          </div>
          <div class="stat-card auth">
            <h3>1</h3>
            <p>Auth Procedure</p>
          </div>
          <div class="stat-card exam">
            <h3>3</h3>
            <p>Exam Procedures</p>
          </div>
        </div>

        <!-- Quick Navigation -->
        <div class="quick-nav">
          <h3>
            <i class="fas fa-rocket"></i> Quick Navigation - All Procedures
          </h3>
          <div class="nav-grid" id="quickNav">
            <!-- Quick nav items will be populated by JavaScript -->
          </div>
        </div>

        <!-- Welcome/Default Content -->
        <div class="procedure-section active" id="welcomeContent">
          <div class="procedure-header">
            <div class="procedure-title">
              <h2>Complete Examination System Documentation</h2>
            </div>
          </div>
          <div class="procedure-content">
            <div class="content-section">
              <h3>Database Overview</h3>
              <p>
                This documentation provides comprehensive details about all 40
                stored procedures in the Examination System database. The system
                supports three main user roles: Admin, Student, and Instructor,
                each with specific functionalities for managing the educational
                ecosystem.
              </p>
            </div>

            <div class="content-section">
              <h3>System Architecture</h3>
              <p>The examination system follows a role-based architecture:</p>
              <ul>
                <li>
                  <strong>Admin Role</strong> - System administration, user
                  management, and overview statistics
                </li>
                <li>
                  <strong>Student Role</strong> - Course access, exam
                  participation, and profile management
                </li>
                <li>
                  <strong>Instructor Role</strong> - Course management, exam
                  creation, and student oversight
                </li>
                <li>
                  <strong>Authentication System</strong> - Secure login and
                  role-based access control
                </li>
                <li>
                  <strong>Exam Engine</strong> - Exam delivery, validation, and
                  submission processing
                </li>
              </ul>
            </div>

            <div class="content-section">
              <h3>Key Features</h3>
              <ul>
                <li>
                  <strong>Complete CRUD Operations</strong> - Create, Read,
                  Update, Delete for all entities
                </li>
                <li>
                  <strong>Transaction Safety</strong> - All write operations use
                  transactions with rollback
                </li>
                <li>
                  <strong>Comprehensive Validation</strong> - Input validation,
                  foreign key checks, business rules
                </li>
                <li>
                  <strong>Role-Based Access Control</strong> - Different
                  procedures for different user roles
                </li>
                <li>
                  <strong>Exam Security</strong> - Time-based access control and
                  validation
                </li>
                <li>
                  <strong>Data Integrity</strong> - Referential integrity
                  maintained through stored procedures
                </li>
              </ul>
            </div>

            <div class="content-section">
              <h3>Database Schema Overview</h3>
              <div class="code-block">
                <div class="code-header">
                  <span>Database Structure</span>
                  <button
                    class="copy-btn"
                    data-code="-- Core Tables:
-- User (User_Id, User_Name, User_Email, User_Password, Role)
-- Student (Student_Id, User_Id, Track_Id, Branch_Id, Intake_Number)
-- Instructor (Instructor_Id, User_Id)
-- Branch_Manager (User_Id, Branch_Id)
-- Course (Course_Id, Course_Name, Duration)
-- Track (Track_Id, Track_Name)
-- Branch (Branch_Id, Branch_Name)
-- Exam (Exam_Id, Course_Id, Date, Time, Duration, Full_Marks, ...)
-- Question (Question_Id, Course_Id, Question_Text, Question_Type)
-- Choice (Choice_Id, Question_Id, Choice_Text, IsCorrect)
-- Answer (Exam_Id, Student_Id, Question_Id, TfSelected, Scored_Marks)

-- Relationship Tables:
-- Teach (Instructor_Id, Course_Id, Track_Id)
-- Assign (Exam_Id, Instructor_Id, Branch_Id, Track_Id)
-- Track_Course (Track_Id, Course_Id)
-- Student_Course (Student_Id, Course_Id)
-- Exam_Questions (Exam_Id, Question_Id)
-- Solve (Student_Id, Question_Id, Solution_Text)"
                  >
                    <i class="far fa-copy"></i> Copy
                  </button>
                </div>
                <pre><code class="language-sql">-- Core Tables:
-- User (User_Id, User_Name, User_Email, User_Password, Role)
-- Student (Student_Id, User_Id, Track_Id, Branch_Id, Intake_Number)
-- Instructor (Instructor_Id, User_Id)
-- Branch_Manager (User_Id, Branch_Id)
-- Course (Course_Id, Course_Name, Duration)
-- Track (Track_Id, Track_Name)
-- Branch (Branch_Id, Branch_Name)
-- Exam (Exam_Id, Course_Id, Date, Time, Duration, Full_Marks, ...)
-- Question (Question_Id, Course_Id, Question_Text, Question_Type)
-- Choice (Choice_Id, Question_Id, Choice_Text, IsCorrect)
-- Answer (Exam_Id, Student_Id, Question_Id, TfSelected, Scored_Marks)

-- Relationship Tables:
-- Teach (Instructor_Id, Course_Id, Track_Id)
-- Assign (Exam_Id, Instructor_Id, Branch_Id, Track_Id)
-- Track_Course (Track_Id, Course_Id)
-- Student_Course (Student_Id, Course_Id)
-- Exam_Questions (Exam_Id, Question_Id)
-- Solve (Student_Id, Question_Id, Solution_Text)</code></pre>
              </div>
            </div>

            <div class="content-section">
              <h3>Getting Started</h3>
              <p>To explore the documentation:</p>
              <ol>
                <li>Use the category filters to view procedures by role</li>
                <li>Search for specific procedures by name or ID</li>
                <li>
                  Click on any procedure in the sidebar or quick navigation to
                  view its complete documentation
                </li>
                <li>
                  Use the "Copy Code" buttons to copy procedure code to
                  clipboard
                </li>
                <li>
                  Each procedure includes: Purpose, Parameters, Returns,
                  Validation, Usage Example, Notes, Error Handling, and Complete
                  SQL Code
                </li>
              </ol>
            </div>
          </div>
        </div>

        <!-- Procedure content sections will be inserted here by JavaScript -->
        <div id="proceduresContainer"></div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script>
      // Complete data for all 40 stored procedures
      const procedures = [
        // ============================================
        // ADMIN PROCEDURES (1-5) - Original Admin Procedures
        // ============================================
        {
          id: 1,
          name: "sp_Admin_GetStudents",
          category: "admin",
          summary: "Retrieves all students with their user information",
          purpose:
            "Retrieves a complete list of all students in the system along with their associated user account information. This is typically used for admin dashboard displays and student management interfaces.",
          parameters: "None",
          returns:
            "Result Set with columns: Student_Id (INT), Track_Id (INT), Branch_Id (INT), User_Id (INT), User_Name (NVARCHAR), User_Email (NVARCHAR)",
          tablesAccessed: "Student (s), User (u)",
          usageExample: "EXEC sp_Admin_GetStudents;",
          notes:
            "Uses INNER JOIN to ensure only students with valid user accounts are returned. No filtering applied - returns all students. Suitable for admin-level views.",
          errorHandling: "None (query-based procedure)",
          code: `CREATE PROCEDURE sp_Admin_GetStudents
AS
BEGIN
    SELECT 
        s.Student_Id,
        s.Track_Id,
        s.Branch_Id,
        u.User_Id,
        u.User_Name,
        u.User_Email
    FROM Student s
    INNER JOIN [User] u 
        ON s.User_Id = u.User_Id
END
GO`,
        },
        {
          id: 2,
          name: "sp_Admin_GetInstructors",
          category: "admin",
          summary: "Retrieves all instructors with their user information",
          purpose:
            "Retrieves a complete list of all instructors in the system along with their associated user account information. Used for admin dashboard instructor management and assignment interfaces.",
          parameters: "None",
          returns:
            "Result Set with columns: Instructor_Id (INT), User_Id (INT), User_Name (NVARCHAR), User_Email (NVARCHAR)",
          tablesAccessed: "Instructor (i), User (u)",
          usageExample: "EXEC sp_Admin_GetInstructors;",
          notes:
            "Uses INNER JOIN to ensure only instructors with valid user accounts are returned. No filtering applied - returns all instructors. Suitable for admin-level views.",
          errorHandling: "None (query-based procedure)",
          code: `CREATE PROCEDURE sp_Admin_GetInstructors
AS
BEGIN
    SELECT 
        i.Instructor_Id,
        u.User_Id,
        u.User_Name,
        u.User_Email
    FROM Instructor i
    INNER JOIN [User] u 
        ON i.User_Id = u.User_Id
END
GO`,
        },
        {
          id: 3,
          name: "sp_Admin_GetDashboardCounts",
          category: "admin",
          summary: "Returns count of total students and instructors",
          purpose:
            "Provides aggregate statistics for the admin dashboard, specifically counting the total number of students and instructors in the system. This is useful for quick overview metrics.",
          parameters: "None",
          returns:
            "Single row result set with columns: StudentCount (INT), InstructorCount (INT)",
          tablesAccessed: "Student, Instructor",
          usageExample: "EXEC sp_Admin_GetDashboardCounts;",
          notes:
            "Uses subqueries to calculate counts independently. Returns a single row with both counts. Efficient for dashboard display purposes.",
          errorHandling: "None (query-based procedure)",
          code: `CREATE PROCEDURE sp_Admin_GetDashboardCounts
AS
BEGIN
    SELECT 
        (SELECT COUNT(*) FROM Student)    AS StudentCount,
        (SELECT COUNT(*) FROM Instructor) AS InstructorCount
END
GO`,
        },
        {
          id: 4,
          name: "sp_Admin_AddInstructor",
          category: "admin",
          summary: "Creates new instructor account with validation",
          purpose:
            "Creates a new instructor account in the system. This procedure handles both the User table entry (authentication) and the Instructor table entry (role-specific data) within a single transaction. Includes comprehensive validation.",
          parameters:
            "@UserName (NVARCHAR(100)), @UserEmail (NVARCHAR(100)), @UserPassword (NVARCHAR(255))",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "User, Instructor",
          validations:
            "Empty string check for all input parameters; Password minimum length of 6 characters; Email uniqueness check (no duplicate emails allowed)",
          errorsThrown:
            "51000: Empty name, email, or password; 51001: Password less than 6 characters; 51002: Email already registered in system",
          usageExample: `EXEC sp_Admin_AddInstructor 
    @UserName = 'John Smith',
    @UserEmail = 'john.smith@school.edu',
    @UserPassword = 'SecurePass123';`,
          notes:
            "Uses transaction to ensure atomic operation. SCOPE_IDENTITY() captures the new User_Id for Instructor insert. Rolls back on any error to maintain data integrity.",
          errorHandling: "TRY-CATCH block with automatic rollback on failure",
          code: `CREATE OR ALTER PROCEDURE sp_Admin_AddInstructor
    @UserName     NVARCHAR(100),
    @UserEmail    NVARCHAR(100),
    @UserPassword NVARCHAR(255)
AS
BEGIN
    SET NOCOUNT ON;

    -- 1Ô∏è‚É£ VALIDATION: Check for Empty Strings
    IF LEN(TRIM(@UserName)) = 0 OR LEN(TRIM(@UserEmail)) = 0 OR LEN(TRIM(@UserPassword)) = 0
    BEGIN
        THROW 51000, 'Error: Name, Email, and Password cannot be empty.', 1;
    END

    -- 2Ô∏è‚É£ VALIDATION: Check Password Length
    IF LEN(@UserPassword) < 6
    BEGIN
        THROW 51001, 'Error: Password must be at least 6 characters long.', 1;
    END

    -- 3Ô∏è‚É£ VALIDATION: Check for Duplicate Email
    IF EXISTS (SELECT 1 FROM [User] WHERE User_Email = @UserEmail)
    BEGIN
        THROW 51002, 'Error: This Email is already registered.', 1;
    END

    -- If validations pass, Insert
    BEGIN TRY
        BEGIN TRANSACTION

        INSERT INTO [User]
            (User_Name, User_Email, User_Password, Role)
        VALUES
            (@UserName, @UserEmail, @UserPassword, 'Instructor')

        DECLARE @UserId INT = SCOPE_IDENTITY()

        INSERT INTO Instructor (User_Id)
        VALUES (@UserId)

        COMMIT TRANSACTION
    END TRY
    BEGIN CATCH
        ROLLBACK TRANSACTION
        THROW;
    END CATCH
END
GO`,
        },
        {
          id: 5,
          name: "sp_Admin_AddStudent",
          category: "admin",
          summary:
            "Creates new student account with track and branch assignment",
          purpose:
            "Creates a new student account in the system with track and branch assignments. Handles both User table entry (authentication) and Student table entry (role and academic details) within a single transaction. Includes extensive validation.",
          parameters:
            "@UserName (NVARCHAR(100)), @UserEmail (NVARCHAR(100)), @UserPassword (NVARCHAR(255)), @TrackId (INT), @BranchId (INT)",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "User, Student",
          validations:
            "Empty string check for name, email, and password; Password minimum length of 6 characters; Email uniqueness check; Track existence validation; Branch existence validation",
          errorsThrown:
            "51000: Empty name, email, or password; 51001: Password less than 6 characters; 51002: Email already registered; 51003: Invalid Track ID; 51004: Invalid Branch ID",
          usageExample: `EXEC sp_Admin_AddStudent 
    @UserName = 'Jane Doe',
    @UserEmail = 'jane.doe@student.edu',
    @UserPassword = 'SecurePass456',
    @TrackId = 1,
    @BranchId = 2;`,
          notes:
            "Uses transaction for atomicity. Validates referential integrity before insertion. SCOPE_IDENTITY() captures User_Id for Student insert.",
          errorHandling:
            "TRY-CATCH block with automatic rollback and error re-throw",
          code: `CREATE OR ALTER PROCEDURE sp_Admin_AddStudent
    @UserName     NVARCHAR(100),
    @UserEmail    NVARCHAR(100),
    @UserPassword NVARCHAR(255),
    @TrackId      INT,
    @BranchId     INT
AS
BEGIN
    SET NOCOUNT ON;

    -- 1Ô∏è‚É£ VALIDATION: Check for Empty Strings
    IF LEN(TRIM(@UserName)) = 0 OR LEN(TRIM(@UserEmail)) = 0 OR LEN(TRIM(@UserPassword)) = 0
    BEGIN
        THROW 51000, 'Error: Name, Email, and Password cannot be empty.', 1;
    END

    -- 2Ô∏è‚É£ VALIDATION: Check Password Length
    IF LEN(@UserPassword) < 6
    BEGIN
        THROW 51001, 'Error: Password must be at least 6 characters long.', 1;
    END

    -- 3Ô∏è‚É£ VALIDATION: Check for Duplicate Email
    IF EXISTS (SELECT 1 FROM [User] WHERE User_Email = @UserEmail)
    BEGIN
        THROW 51002, 'Error: This Email is already registered.', 1;
    END

    -- 4Ô∏è‚É£ VALIDATION: Check if Track Exists
    IF NOT EXISTS (SELECT 1 FROM Track WHERE Track_Id = @TrackId)
    BEGIN
        THROW 51003, 'Error: The selected Track does not exist.', 1;
    END

    -- 5Ô∏è‚É£ VALIDATION: Check if Branch Exists
    IF NOT EXISTS (SELECT 1 FROM Branch WHERE Branch_Id = @BranchId)
    BEGIN
        THROW 51004, 'Error: The selected Branch does not exist.', 1;
    END

    -- If all validations pass, proceed with Transaction
    BEGIN TRY
        BEGIN TRANSACTION

        INSERT INTO [User]
            (User_Name, User_Email, User_Password, Role)
        VALUES
            (@UserName, @UserEmail, @UserPassword, 'Student')

        DECLARE @UserId INT = SCOPE_IDENTITY()

        INSERT INTO Student
            (User_Id, Track_Id, Branch_Id)
        VALUES
            (@UserId, @TrackId, @BranchId)

        COMMIT TRANSACTION
    END TRY
    BEGIN CATCH
        ROLLBACK TRANSACTION
        THROW;
    END CATCH
END
GO`,
        },

        // ============================================
        // STUDENT PROCEDURES (6-10)
        // ============================================
        {
          id: 6,
          name: "sp_Student_GetProfile",
          category: "student",
          summary: "Retrieves student profile with track and branch details",
          purpose:
            "Retrieves complete profile information for a student, including their user details, track assignment, and branch information. This is the primary profile query for student dashboard displays.",
          parameters: "@UserId (INT)",
          returns:
            "Result Set with columns: Student_Id (INT), Intake_Number (INT), Branch_Id (INT), Branch_Name (NVARCHAR), Track_Id (INT), Track_Name (NVARCHAR), User_Id (INT), User_Name (NVARCHAR), User_Email (NVARCHAR)",
          tablesAccessed: "Student (s), User (u), Branch (b), Track (t)",
          usageExample: "EXEC sp_Student_GetProfile @UserId = 101;",
          notes:
            "Returns single row for the specified user. Uses INNER JOINs to ensure complete data. Essential for student portal profile pages.",
          errorHandling: "None (returns empty set if user not found)",
          code: `CREATE PROCEDURE sp_Student_GetProfile
    @UserId INT
AS
BEGIN
    SELECT
        s.Student_Id,
        s.Intake_Number,
        b.Branch_Id,
        b.Branch_Name,
        t.Track_Id,
        t.Track_Name,
        u.User_Id,
        u.User_Name,
        u.User_Email
    FROM Student s
    INNER JOIN [User] u   ON s.User_Id = u.User_Id
    INNER JOIN Branch b  ON s.Branch_Id = b.Branch_Id
    INNER JOIN Track t   ON s.Track_Id  = t.Track_Id
    WHERE u.User_Id = @UserId
END
GO`,
        },
        {
          id: 7,
          name: "sp_Student_GetTrackCourses",
          category: "student",
          summary: "Gets all courses assigned to a specific track",
          purpose:
            "Retrieves all courses that are assigned to a specific academic track. This allows students to see all courses available in their program of study.",
          parameters: "@TrackId (INT)",
          returns:
            "Result Set with columns: Course_Id (INT), Course_Name (NVARCHAR)",
          tablesAccessed: "Course (c), Track_Course (tc)",
          usageExample: "EXEC sp_Student_GetTrackCourses @TrackId = 1;",
          notes:
            "Returns all courses associated with the track. Uses INNER JOIN to ensure only valid course-track associations. Commonly used in course selection/enrollment interfaces.",
          errorHandling: "None (returns empty set if no courses found)",
          code: `CREATE PROCEDURE sp_Student_GetTrackCourses
    @TrackId INT
AS
BEGIN
    SELECT
        c.Course_Id,
        c.Course_Name
    FROM Course c
    INNER JOIN Track_Course tc
        ON c.Course_Id = tc.Course_Id
    WHERE tc.Track_Id = @TrackId
END
GO`,
        },
        {
          id: 8,
          name: "sp_Student_GetCourseTopics",
          category: "student",
          summary: "Counts the number of topics in a course",
          purpose:
            "Counts the total number of topics/lessons within a specific course. This metric helps students understand course scope and progress tracking.",
          parameters: "@CourseId (INT)",
          returns:
            "Result Set with single column: TopicsCount (INT) - Total number of topics in the course",
          tablesAccessed: "Topic",
          usageExample: "EXEC sp_Student_GetCourseTopics @CourseId = 5;",
          notes:
            "Returns 0 if no topics found for the course. Single row, single column result. Useful for progress indicators.",
          errorHandling: "None (COUNT returns 0 for no results)",
          code: `CREATE PROCEDURE sp_Student_GetCourseTopics
    @CourseId INT
AS
BEGIN
    SELECT
        COUNT(*) AS TopicsCount
    FROM Topic
    WHERE Course_Id = @CourseId
END
GO`,
        },
        {
          id: 9,
          name: "sp_Student_GetCourseExams",
          category: "student",
          summary: "Retrieves exam details with student completion status",
          purpose:
            "Retrieves comprehensive exam information for a course, including exam details, question counts, student scores, and completion status. This is the primary exam listing query for student course pages.",
          parameters: "@CourseId (INT), @StudentId (INT)",
          returns:
            "Result Set with columns: Exam_Id (INT), Full_Marks (INT), Date (DATE), Time (TIME), Duration (FLOAT), QuestionCount (INT), StudentScore (INT), IsCompleted (BIT)",
          tablesAccessed:
            "Exam (e), Exam_Questions (eq), Question (q), Answer (a)",
          usageExample: `EXEC sp_Student_GetCourseExams 
    @CourseId = 5,
    @StudentId = 101;`,
          notes:
            "Uses LEFT JOINs to show all exams (even if student hasn't taken them). IsCompleted flag uses EXISTS subquery for accuracy. Groups by exam to aggregate question counts and scores.",
          errorHandling: "None (returns empty set if no exams found)",
          code: `CREATE PROCEDURE sp_Student_GetCourseExams
    @CourseId  INT,
    @StudentId INT
AS
BEGIN
    SELECT
        e.Exam_Id,
        e.Full_Marks,
        e.Date,
        e.Time,
        e.Duration,
        COUNT(q.Question_Id) AS QuestionCount,
        SUM(a.Scored_Marks)  AS StudentScore,
        CASE 
            WHEN EXISTS (
                SELECT 1 FROM Answer a2
                WHERE a2.Exam_Id = e.Exam_Id
                  AND a2.Student_Id = @StudentId
            ) THEN 1 ELSE 0
        END AS IsCompleted
    FROM Exam e
    LEFT JOIN Exam_Questions eq ON e.Exam_Id = eq.Exam_Id
    LEFT JOIN Question q       ON eq.Question_Id = q.Question_Id
    LEFT JOIN Answer a
        ON a.Exam_Id = e.Exam_Id
       AND a.Student_Id = @StudentId
    WHERE e.Course_Id = @CourseId
    GROUP BY
        e.Exam_Id,
        e.Full_Marks,
        e.Date,
        e.Time,
        e.Duration
END
GO`,
        },
        {
          id: 10,
          name: "sp_Student_GetCourseInstructor",
          category: "student",
          summary: "Gets the instructor name for a course and track",
          purpose:
            "Retrieves the instructor's name for a specific course and track combination. This helps students identify who is teaching their section of a course.",
          parameters: "@CourseId (INT), @TrackId (INT)",
          returns:
            "Result Set with single column: InstructorName (NVARCHAR) - Full name of the instructor",
          tablesAccessed: "Teach (t), Instructor (i), User (u)",
          usageExample: `EXEC sp_Student_GetCourseInstructor 
    @CourseId = 5,
    @TrackId = 1;`,
          notes:
            "Uses TOP 1 in case multiple instructors (returns first match). Filters by both course and track for accurate assignment. Returns NULL/empty set if no instructor assigned.",
          errorHandling: "None (returns empty set if no instructor found)",
          code: `CREATE PROCEDURE sp_Student_GetCourseInstructor
    @CourseId INT,
    @TrackId  INT
AS
BEGIN
    SELECT TOP 1
        u.User_Name AS InstructorName
    FROM Teach t
    INNER JOIN Instructor i ON t.Instructor_Id = i.Instructor_Id
    INNER JOIN [User] u     ON i.User_Id = u.User_Id
    WHERE t.Course_Id = @CourseId
      AND t.Track_Id  = @TrackId
END
GO`,
        },

        // ============================================
        // INSTRUCTOR PROCEDURES (11-21)
        // ============================================
        {
          id: 11,
          name: "sp_Instructor_GetAllStudents",
          category: "instructor",
          summary: "Retrieves all students in the system",
          purpose:
            "Retrieves a complete list of all students in the system with their user details and academic assignments. Used by instructors for student management and reporting.",
          parameters: "None",
          returns:
            "Result Set with columns: Student_Id (INT), Intake_Number (INT), User_Id (INT), User_Name (NVARCHAR), User_Email (NVARCHAR), Track_Id (INT), Branch_Id (INT)",
          tablesAccessed: "Student (s), User (u)",
          usageExample: "EXEC sp_Instructor_GetAllStudents;",
          notes:
            "Returns all students without filtering. Useful for instructor dashboards and reports. Includes intake number for cohort management.",
          errorHandling: "None (query-based procedure)",
          code: `CREATE OR ALTER PROCEDURE sp_Instructor_GetAllStudents
AS
BEGIN
    SELECT
        s.Student_Id,
        s.Intake_Number,
        u.User_Id,
        u.User_Name,
        u.User_Email,
        s.Track_Id,
        s.Branch_Id
    FROM Student s
    INNER JOIN [User] u ON s.User_Id = u.User_Id;
END
GO`,
        },
        {
          id: 12,
          name: "sp_Instructor_GetStudentsByIntake",
          category: "instructor",
          summary: "Filters students by intake number",
          purpose:
            "Filters and retrieves students belonging to a specific intake/cohort number. This allows instructors to view students by enrollment period.",
          parameters: "@Intake (INT)",
          returns:
            "Result Set with columns: Student_Id (INT), Intake_Number (INT), User_Id (INT), User_Name (NVARCHAR), User_Email (NVARCHAR), Track_Id (INT), Branch_Id (INT)",
          tablesAccessed: "Student (s), User (u)",
          validations:
            "@Intake must not be NULL; @Intake must be greater than 0",
          errorsThrown: "50001: Invalid intake number",
          usageExample: "EXEC sp_Instructor_GetStudentsByIntake @Intake = 42;",
          notes:
            "Validates intake before querying. Returns empty set if no students in that intake.",
          errorHandling: "Throws error for invalid intake parameter",
          code: `CREATE OR ALTER PROCEDURE sp_Instructor_GetStudentsByIntake
    @Intake INT
AS
BEGIN
    IF @Intake IS NULL OR @Intake <= 0
        THROW 50001, 'Invalid intake number.', 1;

    SELECT
        s.Student_Id,
        s.Intake_Number,
        u.User_Id,
        u.User_Name,
        u.User_Email,
        s.Track_Id,
        s.Branch_Id
    FROM Student s
    INNER JOIN [User] u ON s.User_Id = u.User_Id
    WHERE s.Intake_Number = @Intake;
END
GO`,
        },
        {
          id: 13,
          name: "sp_Instructor_AddStudent",
          category: "instructor",
          summary: "Creates new student with intake assignment",
          purpose:
            "Creates a new student account with track, branch, and intake assignments. This instructor-facing version includes intake number specification and comprehensive validation.",
          parameters:
            "@Name (NVARCHAR(100)), @Email (NVARCHAR(100)), @Password (NVARCHAR(100)), @TrackId (INT), @BranchId (INT), @Intake (INT)",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "User, Student",
          validations:
            "Name is not null or empty; Email uniqueness check; Track existence validation; Branch existence validation",
          errorsThrown:
            "50002: Student name is required; 50003: Email already exists; 50004: Invalid Track; 50005: Invalid Branch",
          usageExample: `EXEC sp_Instructor_AddStudent 
    @Name = 'Alice Johnson',
    @Email = 'alice.j@student.edu',
    @Password = 'Pass123',
    @TrackId = 1,
    @BranchId = 2,
    @Intake = 42;`,
          notes:
            "Uses transaction for atomicity. Automatically assigns 'Student' role. SCOPE_IDENTITY() captures User_Id.",
          errorHandling: "TRY-CATCH with automatic rollback and error re-throw",
          code: `CREATE OR ALTER PROCEDURE sp_Instructor_AddStudent
    @Name NVARCHAR(100),
    @Email NVARCHAR(100),
    @Password NVARCHAR(100),
    @TrackId INT,
    @BranchId INT,
    @Intake INT
AS
BEGIN
    BEGIN TRY
        BEGIN TRAN;

        IF @Name IS NULL OR LTRIM(@Name) = ''
            THROW 50002, 'Student name is required.', 1;

        IF EXISTS (SELECT 1 FROM [User] WHERE User_Email = @Email)
            THROW 50003, 'Email already exists.', 1;

        IF NOT EXISTS (SELECT 1 FROM Track WHERE Track_Id = @TrackId)
            THROW 50004, 'Invalid Track.', 1;

        IF NOT EXISTS (SELECT 1 FROM Branch WHERE Branch_Id = @BranchId)
            THROW 50005, 'Invalid Branch.', 1;

        INSERT INTO [User] (User_Name, User_Email, User_Password, Role)
        VALUES (@Name, @Email, @Password, 'Student');

        DECLARE @UserId INT = SCOPE_IDENTITY();

        INSERT INTO Student (User_Id, Track_Id, Branch_Id, Intake_Number)
        VALUES (@UserId, @TrackId, @BranchId, @Intake);

        COMMIT;
    END TRY
    BEGIN CATCH
        IF @@TRANCOUNT > 0 ROLLBACK;
        THROW;
    END CATCH
END
GO`,
        },
        {
          id: 14,
          name: "sp_Instructor_UpdateStudent",
          category: "instructor",
          summary: "Updates existing student information",
          purpose:
            "Updates existing student information including user details and academic assignments. Allows instructors to modify student records in both User and Student tables.",
          parameters:
            "@UserId (INT), @Name (NVARCHAR(100)), @Email (NVARCHAR(100)), @TrackId (INT), @BranchId (INT), @Intake (INT)",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "User, Student",
          validations: "User existence check",
          errorsThrown: "50006: User not found",
          usageExample: `EXEC sp_Instructor_UpdateStudent 
    @UserId = 101,
    @Name = 'Alice M. Johnson',
    @Email = 'alice.johnson@student.edu',
    @TrackId = 2,
    @BranchId = 1,
    @Intake = 43;`,
          notes:
            "Uses transaction for atomicity. Updates both tables in single transaction. Does not validate track/branch existence (assumes valid IDs).",
          errorHandling: "TRY-CATCH with automatic rollback and error re-throw",
          code: `CREATE OR ALTER PROCEDURE sp_Instructor_UpdateStudent
    @UserId INT,
    @Name NVARCHAR(100),
    @Email NVARCHAR(100),
    @TrackId INT,
    @BranchId INT,
    @Intake INT
AS
BEGIN
    BEGIN TRY
        BEGIN TRAN;

        IF NOT EXISTS (SELECT 1 FROM [User] WHERE User_Id = @UserId)
            THROW 50006, 'User not found.', 1;

        UPDATE [User]
        SET User_Name = @Name,
            User_Email = @Email
        WHERE User_Id = @UserId;

        UPDATE Student
        SET Track_Id = @TrackId,
            Branch_Id = @BranchId,
            Intake_Number = @Intake
        WHERE User_Id = @UserId;

        COMMIT;
    END TRY
    BEGIN CATCH
        IF @@TRANCOUNT > 0 ROLLBACK;
        THROW;
    END CATCH
END
GO`,
        },
        {
          id: 15,
          name: "sp_Instructor_DeleteStudent",
          category: "instructor",
          summary: "Removes student and all related records",
          purpose:
            "Permanently removes a student from the system, including all related records such as answers, solutions, and course enrollments. This is a cascading delete operation that maintains referential integrity.",
          parameters: "@UserId (INT)",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "Answer, Solve, Student_Course, Student, User",
          validations: "Student existence check",
          errorsThrown: "50007: Student not found",
          usageExample: "EXEC sp_Instructor_DeleteStudent @UserId = 101;",
          notes:
            "Cascades through all dependent tables. Uses transaction for atomicity. Permanent deletion - cannot be undone. Order of deletions respects foreign key constraints.",
          errorHandling: "TRY-CATCH with automatic rollback and error re-throw",
          code: `CREATE OR ALTER PROCEDURE sp_Instructor_DeleteStudent
    @UserId INT
AS
BEGIN
    BEGIN TRY
        BEGIN TRAN;

        DECLARE @StudentId INT;

        SELECT @StudentId = Student_Id
        FROM Student
        WHERE User_Id = @UserId;

        IF @StudentId IS NULL
            THROW 50007, 'Student not found.', 1;

        DELETE FROM Answer WHERE Student_Id = @StudentId;
        DELETE FROM Solve WHERE Student_Id = @StudentId;
        DELETE FROM Student_Course WHERE Student_Id = @StudentId;

        DELETE FROM Student WHERE Student_Id = @StudentId;
        DELETE FROM [User] WHERE User_Id = @UserId;

        COMMIT;
    END TRY
    BEGIN CATCH
        IF @@TRANCOUNT > 0 ROLLBACK;
        THROW;
    END CATCH
END
GO`,
        },
        {
          id: 16,
          name: "sp_Instructor_GetCourses",
          category: "instructor",
          summary: "Retrieves all courses with instructor information",
          purpose:
            "Retrieves a complete list of all courses with their details and assigned instructors. This provides a comprehensive course catalog view for instructors.",
          parameters: "None",
          returns:
            "Result Set with columns: Course_Id (INT), Course_Name (NVARCHAR), Duration (INT), InstructorName (NVARCHAR)",
          tablesAccessed: "Course (c), Teach (t), Instructor (i), User (u)",
          usageExample: "EXEC sp_Instructor_GetCourses;",
          notes:
            "Uses LEFT JOINs to show all courses (even unassigned ones). InstructorName will be NULL for courses without instructors. Useful for course management dashboards.",
          errorHandling: "None (query-based procedure)",
          code: `CREATE OR ALTER PROCEDURE sp_Instructor_GetCourses
AS
BEGIN
    SELECT
        c.Course_Id,
        c.Course_Name,
        c.Duration,
        u.User_Name AS InstructorName
    FROM Course c
    LEFT JOIN Teach t ON c.Course_Id = t.Course_Id
    LEFT JOIN Instructor i ON t.Instructor_Id = i.Instructor_Id
    LEFT JOIN [User] u ON i.User_Id = u.User_Id;
END
GO`,
        },
        {
          id: 17,
          name: "sp_Instructor_SaveCourse",
          category: "instructor",
          summary: "Inserts new course or updates existing one",
          purpose:
            "Dual-purpose procedure that either creates a new course or updates an existing one based on whether @CourseId is provided. This simplifies course management by combining insert and update operations.",
          parameters:
            "@CourseId (INT) [OPTIONAL], @Name (NVARCHAR(100)), @Duration (INT)",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "Course",
          validations:
            "Course name is not null or empty; Duration must be greater than 0",
          errorsThrown:
            "50008: Course name is required; 50009: Invalid course duration",
          usageExample: `-- Insert new course
EXEC sp_Instructor_SaveCourse 
    @CourseId = NULL,
    @Name = 'Advanced SQL',
    @Duration = 8;

-- Update existing course
EXEC sp_Instructor_SaveCourse 
    @CourseId = 5,
    @Name = 'Advanced SQL Programming',
    @Duration = 10;`,
          notes:
            "@CourseId = NULL triggers INSERT operation; @CourseId with value triggers UPDATE operation; No transaction needed for single table operation.",
          errorHandling: "Throws errors for validation failures",
          code: `CREATE OR ALTER PROCEDURE sp_Instructor_SaveCourse
    @CourseId INT = NULL,
    @Name NVARCHAR(100),
    @Duration INT
AS
BEGIN
    IF @Name IS NULL OR LTRIM(@Name) = ''
        THROW 50008, 'Course name is required.', 1;

    IF @Duration <= 0
        THROW 50009, 'Invalid course duration.', 1;

    IF @CourseId IS NULL
        INSERT INTO Course (Course_Name, Duration)
        VALUES (@Name, @Duration);
    ELSE
        UPDATE Course
        SET Course_Name = @Name,
            Duration = @Duration
        WHERE Course_Id = @CourseId;
END
GO`,
        },
        {
          id: 18,
          name: "sp_Instructor_DeleteCourse",
          category: "instructor",
          summary: "Removes course and related exam assignments",
          purpose:
            "Permanently removes a course from the system, including all related exam assignments. This cascading delete ensures referential integrity.",
          parameters: "@CourseId (INT)",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "Assign, Exam, Course",
          validations: "Course existence check",
          errorsThrown: "50010: Course not found",
          usageExample: "EXEC sp_Instructor_DeleteCourse @CourseId = 5;",
          notes:
            "Cascades through Assign table to Exam table to Course table. Order of deletions respects foreign key constraints. Permanent deletion - cannot be undone.",
          errorHandling: "Throws error if course doesn't exist",
          code: `CREATE OR ALTER PROCEDURE sp_Instructor_DeleteCourse
    @CourseId INT
AS
BEGIN
    IF NOT EXISTS (SELECT 1 FROM Course WHERE Course_Id = @CourseId)
        THROW 50010, 'Course not found.', 1;

    DELETE FROM Assign WHERE Exam_Id IN (
        SELECT Exam_Id FROM Exam WHERE Course_Id = @CourseId
    );

    DELETE FROM Exam WHERE Course_Id = @CourseId;
    DELETE FROM Course WHERE Course_Id = @CourseId;
END
GO`,
        },
        {
          id: 19,
          name: "sp_Instructor_GetExams",
          category: "instructor",
          summary: "Retrieves all exams with course information",
          purpose:
            "Retrieves a comprehensive list of all exams in the system with course information and scheduling details. Results are ordered by date in descending order (most recent first).",
          parameters: "None",
          returns:
            "Result Set with columns: Exam_Id (INT), Course_Name (NVARCHAR), Date (DATE), Time (TIME), Duration (FLOAT), Full_Marks (INT)",
          tablesAccessed: "Exam (e), Course (c)",
          usageExample: "EXEC sp_Instructor_GetExams;",
          notes:
            "Results ordered by Date DESC (newest first). Uses INNER JOIN (only shows exams with valid courses). Useful for exam management and scheduling views.",
          errorHandling: "None (query-based procedure)",
          code: `CREATE OR ALTER PROCEDURE sp_Instructor_GetExams
AS
BEGIN
    SELECT
        e.Exam_Id,
        c.Course_Name,
        e.Date,
        e.Time,
        e.Duration,
        e.Full_Marks
    FROM Exam e
    INNER JOIN Course c ON e.Course_Id = c.Course_Id
    ORDER BY e.Date DESC;
END
GO`,
        },
        {
          id: 20,
          name: "sp_Instructor_CreateExam",
          category: "instructor",
          summary: "Creates new exam with question counts and assignments",
          purpose:
            "Creates a new exam with question type specifications and automatically assigns it to students in the specified branch and track. This comprehensive procedure handles exam creation, question count calculation, and initial assignment.",
          parameters:
            "@CourseId (INT), @Date (DATE), @Time (TIME), @Duration (FLOAT), @FullMarks (INT), @McqCount (INT), @TfCount (INT), @McqMarks (INT), @TfMarks (INT), @BranchId (INT), @TrackId (INT)",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "Exam, Assign",
          validations:
            "Course existence check; Duration must be greater than 0; Full marks must be greater than 0",
          errorsThrown: "50011: Invalid course; 50012: Invalid exam values",
          usageExample: `EXEC sp_Instructor_CreateExam 
    @CourseId = 5,
    @Date = '2026-02-15',
    @Time = '10:00:00',
    @Duration = 90.0,
    @FullMarks = 100,
    @McqCount = 20,
    @TfCount = 10,
    @McqMarks = 4,
    @TfMarks = 2,
    @BranchId = 1,
    @TrackId = 1;`,
          notes:
            "Automatically calculates QuestionCount (MCQ + T/F). Uses SCOPE_IDENTITY() to capture new Exam_Id for assignment. Assigns to first instructor (simplified assignment logic). Transaction ensures atomicity.",
          errorHandling: "TRY-CATCH with automatic rollback and error re-throw",
          code: `CREATE OR ALTER PROCEDURE sp_Instructor_CreateExam
    @CourseId INT,
    @Date DATE,
    @Time TIME,
    @Duration FLOAT,
    @FullMarks INT,
    @McqCount INT,
    @TfCount INT,
    @McqMarks INT,
    @TfMarks INT,
    @BranchId INT,
    @TrackId INT
AS
BEGIN
    BEGIN TRY
        BEGIN TRAN;

        IF NOT EXISTS (SELECT 1 FROM Course WHERE Course_Id = @CourseId)
            THROW 50011, 'Invalid course.', 1;

        IF @Duration <= 0 OR @FullMarks <= 0
            THROW 50012, 'Invalid exam values.', 1;

        INSERT INTO Exam
        (Course_Id, Date, Time, Duration, Full_Marks,
         McqCount, TrueFalseCount, McqMarks, TrueFalseMarks,
         QuestionCount)
        VALUES
        (@CourseId, @Date, @Time, @Duration, @FullMarks,
         @McqCount, @TfCount, @McqMarks, @TfMarks,
         ISNULL(@McqCount,0) + ISNULL(@TfCount,0));

        DECLARE @ExamId INT = SCOPE_IDENTITY();

        INSERT INTO Assign (Exam_Id, Instructor_Id, Branch_Id, Track_Id)
        VALUES
        (@ExamId,
         (SELECT TOP 1 Instructor_Id FROM Instructor),
         @BranchId,
         @TrackId);

        COMMIT;
    END TRY
    BEGIN CATCH
        IF @@TRANCOUNT > 0 ROLLBACK;
        THROW;
    END CATCH
END
GO`,
        },
        {
          id: 21,
          name: "sp_Instructor_DeleteExam",
          category: "instructor",
          summary: "Removes exam and all related records",
          purpose:
            "Permanently removes an exam from the system, including all student answers and exam assignments. This cascading delete maintains referential integrity.",
          parameters: "@ExamId (INT)",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "Answer, Assign, Exam",
          usageExample: "EXEC sp_Instructor_DeleteExam @ExamId = 42;",
          notes:
            "Cascades through Answer and Assign tables first. Order respects foreign key constraints. Permanent deletion - cannot be undone. Uses transaction for atomicity.",
          errorHandling: "TRY-CATCH with automatic rollback and error re-throw",
          code: `CREATE OR ALTER PROCEDURE sp_Instructor_DeleteExam
    @ExamId INT
AS
BEGIN
    BEGIN TRAN;
    BEGIN TRY
        DELETE FROM Answer WHERE Exam_Id = @ExamId;
        DELETE FROM Assign WHERE Exam_Id = @ExamId;
        DELETE FROM Exam   WHERE Exam_Id = @ExamId;
        COMMIT;
    END TRY
    BEGIN CATCH
        ROLLBACK;
        THROW;
    END CATCH
END
GO`,
        },

        // ============================================
        // AUTHENTICATION PROCEDURES (22)
        // ============================================
        {
          id: 22,
          name: "sp_LoginUser",
          category: "auth",
          summary: "Authenticates user and returns role information",
          purpose:
            "Authenticates a user by email and password, returning their account information including role and branch (if they are a branch manager). This is the primary authentication endpoint for the system.",
          parameters: "@Email (NVARCHAR(100)), @Password (NVARCHAR(100))",
          returns:
            "Result Set with columns: User_Id (INT), User_Email (NVARCHAR), Role (NVARCHAR), Branch_Id (INT)",
          tablesAccessed: "User (u), Branch_Manager (bm)",
          usageExample: `EXEC sp_LoginUser 
    @Email = 'john.smith@school.edu',
    @Password = 'SecurePass123';`,
          notes:
            "Uses LEFT JOIN for Branch_Manager (most users won't have branch). Returns empty set for invalid credentials. Does not hash passwords (security consideration for production). Single row result on success, empty on failure.",
          errorHandling: "None (returns empty set for invalid login)",
          code: `CREATE OR ALTER PROCEDURE sp_LoginUser
    @Email NVARCHAR(100),
    @Password NVARCHAR(100)
AS
BEGIN
    SELECT
        u.User_Id,
        u.User_Email,
        u.Role,
        bm.Branch_Id
    FROM [User] u
    LEFT JOIN Branch_Manager bm ON bm.User_Id = u.User_Id
    WHERE u.User_Email = @Email
      AND u.User_Password = @Password;
END
GO`,
        },

        // ============================================
        // EXAM MANAGEMENT PROCEDURES (23-25)
        // ============================================
        {
          id: 23,
          name: "sp_Exam_ValidateAccess",
          category: "exam",
          summary: "Validates student access to exam based on timing",
          purpose:
            "Validates whether a student has access to take a specific exam based on their branch/track assignment and whether the exam is currently active (within the scheduled time window). This is a critical security check before allowing exam access.",
          parameters: "@ExamId (INT), @StudentId (INT)",
          returns:
            "Result Set with columns: Exam_Id (INT), Course_Id (INT), Duration (FLOAT), Full_Marks (INT), Date (DATE), Time (TIME)",
          tablesAccessed: "Student (s), Assign (a), Exam (e)",
          usageExample: `EXEC sp_Exam_ValidateAccess 
    @ExamId = 42,
    @StudentId = 101;`,
          notes:
            "Uses GETDATE() for current time comparison. Calculates exam end time using DATEADD with Duration. Combines Date and Time fields for accurate datetime comparison. Returns empty set (access denied) if any condition fails.",
          errorHandling: "None (returns empty set for denied access)",
          code: `CREATE OR ALTER PROCEDURE sp_Exam_ValidateAccess
    @ExamId INT,
    @StudentId INT
AS
BEGIN
    SET NOCOUNT ON;

    DECLARE @Now DATETIME = GETDATE();

    SELECT
        e.Exam_Id,
        e.Course_Id,
        e.Duration,
        e.Full_Marks,
        e.Date,
        e.Time
    FROM Student s
    INNER JOIN Assign a
        ON a.Branch_Id = s.Branch_Id
       AND a.Track_Id  = s.Track_Id
    INNER JOIN Exam e
        ON e.Exam_Id = a.Exam_Id
    WHERE s.Student_Id = @StudentId
      AND e.Exam_Id = @ExamId
      AND (
            @Now BETWEEN
            CAST(e.Date AS DATETIME) + CAST(e.Time AS DATETIME)
            AND
            DATEADD(MINUTE, e.Duration,
                CAST(e.Date AS DATETIME) + CAST(e.Time AS DATETIME))
          );
END
GO`,
        },
        {
          id: 24,
          name: "sp_Exam_GetQuestions",
          category: "exam",
          summary: "Retrieves random MCQ and True/False questions",
          purpose:
            "Retrieves a randomized selection of questions for an exam, including both multiple choice questions (MCQs) with their answer choices and true/false questions. This generates the actual question set for a student taking an exam.",
          parameters: "@CourseId (INT), @McqCount (INT), @TfCount (INT)",
          returns:
            "Two result sets: 1) MCQ Questions with columns: Question_Id, Question_Text, Question_Type, Choice_Id, Choice_Text, IsCorrect; 2) True/False Questions with columns: Question_Id, Question_Text, Question_Type, Choice_Id (NULL), Choice_Text (NULL), IsCorrect (NULL)",
          tablesAccessed: "Question (q), Choice (c)",
          usageExample: `EXEC sp_Exam_GetQuestions 
    @CourseId = 5,
    @McqCount = 20,
    @TfCount = 10;`,
          notes:
            "Uses NEWID() for random selection. TOP clause limits results to requested counts. MCQ questions include all choices (correct and incorrect). T/F questions have NULL values for choice fields. Each execution returns different random questions.",
          errorHandling:
            "None (returns empty sets if insufficient questions available)",
          code: `CREATE OR ALTER PROCEDURE sp_Exam_GetQuestions
    @CourseId INT,
    @McqCount INT,
    @TfCount INT
AS
BEGIN
    SET NOCOUNT ON;

    -- MCQs
    SELECT TOP (@McqCount)
        q.Question_Id,
        q.Question_Text,
        q.Question_Type,
        c.Choice_Id,
        c.Choice_Text,
        c.IsCorrect
    FROM Question q
    INNER JOIN Choice c ON q.Question_Id = c.Question_Id
    WHERE q.Course_Id = @CourseId
      AND q.Question_Type = 'MCQ'
    ORDER BY NEWID();

    -- True/False
    SELECT TOP (@TfCount)
        q.Question_Id,
        q.Question_Text,
        q.Question_Type,
        NULL AS Choice_Id,
        NULL AS Choice_Text,
        NULL AS IsCorrect
    FROM Question q
    WHERE q.Course_Id = @CourseId
      AND q.Question_Type = 'TF'
    ORDER BY NEWID();
END
GO`,
        },
        {
          id: 25,
          name: "sp_Exam_Submit",
          category: "exam",
          summary: "Submits student answers to the database",
          purpose:
            "Submits a student's exam answers to the database. Accepts answers in JSON format and inserts them into the Answer table for grading. This is the final step of the exam-taking process.",
          parameters:
            "@ExamId (INT), @StudentId (INT), @AnswersJson (NVARCHAR(MAX))",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "Answer",
          usageExample: `DECLARE @Answers NVARCHAR(MAX) = '[
    {"QuestionId": 1, "TrueFalseAnswer": true},
    {"QuestionId": 2, "TrueFalseAnswer": false},
    {"QuestionId": 3, "TrueFalseAnswer": true}
]';

EXEC sp_Exam_Submit 
    @ExamId = 42,
    @StudentId = 101,
    @AnswersJson = @Answers;`,
          notes:
            "Uses OPENJSON to parse JSON array into relational format. Currently only handles TrueFalseAnswer field. Should be extended to handle MCQ choice selections. No duplicate answer prevention (should be added). No grading logic (handled elsewhere).",
          errorHandling: "None (relies on database constraints)",
          code: `CREATE OR ALTER PROCEDURE sp_Exam_Submit
    @ExamId INT,
    @StudentId INT,
    @AnswersJson NVARCHAR(MAX)
AS
BEGIN
    SET NOCOUNT ON;

    INSERT INTO Answer (Exam_Id, Student_Id, Question_Id, TfSelected)
    SELECT
        @ExamId,
        @StudentId,
        QuestionId,
        TrueFalseAnswer
    FROM OPENJSON(@AnswersJson)
    WITH (
        QuestionId INT,
        TrueFalseAnswer BIT
    );
END
GO`,
        },

        // ============================================
        // NEW ADMIN CRUD PROCEDURES (26-40)
        // ============================================
        {
          id: 26,
          name: "sp_Admin_AddStudent",
          category: "admin",
          summary: "Creates new student account with validation",
          purpose:
            "Creates a new student account in the system. This procedure performs a two-step insertion: first creating a user account with student role, then creating the corresponding student profile with academic information.",
          parameters:
            "@FullName (NVARCHAR(100)): Student's full name, @Email (NVARCHAR(100)): Student's email address (must be unique), @Password (NVARCHAR(255)): Hashed password for authentication, @BranchId (INT): Branch_Id where student is enrolled, @TrackId (INT): Track_Id of student's study track, @IntakeNumber (INT): Intake cohort number",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "User, Student",
          validations:
            "Email must be unique across all users; Both User and Student records created in single transaction; Student role automatically assigned; User_Id is auto-generated and used as foreign key",
          errorsThrown: "51000: Email already exists",
          usageExample: `EXEC sp_Admin_AddStudent 
    @FullName = 'Ahmed Mohamed',
    @Email = 'ahmed.mohamed@iti.gov.eg',
    @Password = '$2a$11$hashed_password_here',
    @BranchId = 1,
    @TrackId = 3,
    @IntakeNumber = 44;`,
          notes:
            "Password should be hashed before calling this procedure. Transaction ensures atomic operation. Uses SCOPE_IDENTITY() to get newly created User_Id.",
          errorHandling: "TRY-CATCH block with automatic rollback on failure",
          code: `CREATE OR ALTER PROCEDURE sp_Admin_AddStudent
    @FullName NVARCHAR(100),
    @Email NVARCHAR(100),
    @Password NVARCHAR(255),
    @BranchId INT,
    @TrackId INT,
    @IntakeNumber INT
AS
BEGIN
    SET NOCOUNT ON;
    
    -- Check if email exists
    IF EXISTS (SELECT 1 FROM [User] WHERE User_Email = @Email)
    BEGIN
        THROW 51000, 'Email already exists.', 1;
    END

    BEGIN TRANSACTION;
    BEGIN TRY
        -- 1. Insert into User
        INSERT INTO [User] (User_Name, User_Email, User_Password, Role)
        VALUES (@FullName, @Email, @Password, 'Student');

        DECLARE @NewUserId INT = SCOPE_IDENTITY();

        -- 2. Insert into Student
        INSERT INTO Student (User_Id, Branch_Id, Track_Id, Intake_Number)
        VALUES (@NewUserId, @BranchId, @TrackId, @IntakeNumber);

        COMMIT TRANSACTION;
    END TRY
    BEGIN CATCH
        ROLLBACK TRANSACTION;
        THROW;
    END CATCH
END
GO`,
        },
        {
          id: 27,
          name: "sp_Admin_UpdateStudent",
          category: "admin",
          summary: "Updates existing student information",
          purpose:
            "Updates existing student information including personal details and academic enrollment. Allows modification of student's name, email, branch, track, and intake while maintaining data integrity.",
          parameters:
            "@StudentId (INT): Student_Id to update, @FullName (NVARCHAR(100)): Updated full name, @Email (NVARCHAR(100)): Updated email address, @BranchId (INT): Updated branch assignment, @TrackId (INT): Updated track assignment, @IntakeNumber (INT): Updated intake number",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "User, Student",
          validations:
            "Email must remain unique (excluding current student's email); Cannot change email to one already in use by another user; Updates both User and Student tables atomically; Preserves User_Id and Student_Id",
          errorsThrown: "51000: Email conflicts with another user",
          usageExample: `EXEC sp_Admin_UpdateStudent 
    @StudentId = 150,
    @FullName = 'Ahmed Mohamed Ali',
    @Email = 'ahmed.ali@iti.gov.eg',
    @BranchId = 2,
    @TrackId = 3,
    @IntakeNumber = 44;`,
          notes:
            "Student can keep same email or change to new unique email. User_Id lookup ensures updates affect correct user. No password change in this procedure.",
          errorHandling: "Transaction ensures both tables update together",
          code: `CREATE OR ALTER PROCEDURE sp_Admin_UpdateStudent
    @StudentId INT,
    @FullName NVARCHAR(100),
    @Email NVARCHAR(100),
    @BranchId INT,
    @TrackId INT,
    @IntakeNumber INT
AS
BEGIN
    SET NOCOUNT ON;
    
    DECLARE @UserId INT;
    SELECT @UserId = User_Id FROM Student WHERE Student_Id = @StudentId;

    -- Check if email is taken by ANOTHER user
    IF EXISTS (SELECT 1 FROM [User] WHERE User_Email = @Email AND User_Id <> @UserId)
    BEGIN
        THROW 51000, 'Email already exists.', 1;
    END

    BEGIN TRANSACTION;
        -- Update User info
        UPDATE [User] 
        SET User_Name = @FullName, User_Email = @Email 
        WHERE User_Id = @UserId;

        -- Update Student info
        UPDATE Student 
        SET Branch_Id = @BranchId, Track_Id = @TrackId, Intake_Number = @IntakeNumber 
        WHERE Student_Id = @StudentId;
    COMMIT TRANSACTION;
END
GO`,
        },
        {
          id: 28,
          name: "sp_Admin_DeleteStudent",
          category: "admin",
          summary: "Removes student and associated user account",
          purpose:
            "Permanently removes a student and their associated user account from the system. This is a destructive operation that deletes all student-specific data while maintaining referential integrity.",
          parameters: "@StudentId (INT): Student_Id to delete",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "Student, User",
          validations:
            "Deletion is permanent and cannot be undone; Both Student and User records deleted in single transaction; Cascading deletes may affect related tables (Answer, Exam_Student, etc.); Order matters: Student deleted before User to maintain FK constraints",
          usageExample: "EXEC sp_Admin_DeleteStudent @StudentId = 150;",
          notes:
            "Consider soft delete (IsActive flag) instead for audit purposes. May fail if student has exam history or other dependencies. User_Id lookup ensures correct user account is deleted.",
          errorHandling: "Transaction rollback if either delete fails",
          code: `CREATE OR ALTER PROCEDURE sp_Admin_DeleteStudent
    @StudentId INT
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @UserId INT;
    SELECT @UserId = User_Id FROM Student WHERE Student_Id = @StudentId;

    BEGIN TRANSACTION;
        DELETE FROM Student WHERE Student_Id = @StudentId;
        DELETE FROM [User] WHERE User_Id = @UserId;
    COMMIT TRANSACTION;
END
GO`,
        },
        {
          id: 29,
          name: "sp_Admin_AddInstructor",
          category: "admin",
          summary: "Creates new instructor account",
          purpose:
            "Creates a new instructor account in the system. Similar to student creation, this procedure creates both a user account with instructor role and the corresponding instructor profile.",
          parameters:
            "@FullName (NVARCHAR(100)): Instructor's full name, @Email (NVARCHAR(100)): Instructor's email address (must be unique), @Password (NVARCHAR(255)): Hashed password for authentication",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "User, Instructor",
          validations:
            "Email must be unique across all users (students, instructors, admins); Both User and Instructor records created in single transaction; Instructor role automatically assigned",
          errorsThrown: "51000: Email already exists",
          usageExample: `EXEC sp_Admin_AddInstructor 
    @FullName = 'Dr. Sara Ahmed',
    @Email = 'sara.ahmed@iti.gov.eg',
    @Password = '$2a$11$hashed_password_here';`,
          notes:
            "Password should be hashed before calling this procedure. Transaction ensures atomic operation. Uses SCOPE_IDENTITY() to link User and Instructor records.",
          errorHandling: "TRY-CATCH block with automatic rollback on failure",
          code: `CREATE OR ALTER PROCEDURE sp_Admin_AddInstructor
    @FullName NVARCHAR(100),
    @Email NVARCHAR(100),
    @Password NVARCHAR(255)
AS
BEGIN
    SET NOCOUNT ON;
    
    IF EXISTS (SELECT 1 FROM [User] WHERE User_Email = @Email)
    BEGIN
        THROW 51000, 'Email already exists.', 1;
    END

    BEGIN TRANSACTION;
        INSERT INTO [User] (User_Name, User_Email, User_Password, Role)
        VALUES (@FullName, @Email, @Password, 'Instructor');

        DECLARE @NewUserId INT = SCOPE_IDENTITY();

        INSERT INTO Instructor (User_Id) VALUES (@NewUserId);
    COMMIT TRANSACTION;
END
GO`,
        },
        {
          id: 30,
          name: "sp_Admin_UpdateInstructor",
          category: "admin",
          summary: "Updates instructor information with optional password",
          purpose:
            "Updates existing instructor information including name, email, and optionally password. Provides flexibility to update credentials while maintaining security and data integrity.",
          parameters:
            "@InstructorId (INT): Instructor_Id to update, @FullName (NVARCHAR(100)): Updated full name, @Email (NVARCHAR(100)): Updated email address, @Password (NVARCHAR(255)): Updated password (optional, NULL to keep existing)",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "User",
          validations:
            "Email must remain unique (excluding current instructor's email); Password update is optional (NULL = no change); Only User table updated (Instructor table has no mutable fields); Cannot change instructor's role",
          errorsThrown: "51000: Email conflicts with another user",
          usageExample: `-- Update name and email only
EXEC sp_Admin_UpdateInstructor 
    @InstructorId = 25,
    @FullName = 'Dr. Sara Ahmed Mohamed',
    @Email = 'sara.ahmed@iti.gov.eg',
    @Password = NULL;`,
          notes:
            "Password parameter defaults to NULL for optional updates. Uses ISNULL to preserve existing password when NULL passed. No transaction needed (single table update).",
          errorHandling: "ISNULL ensures password only updates when provided",
          code: `CREATE OR ALTER PROCEDURE sp_Admin_UpdateInstructor
    @InstructorId INT,
    @FullName NVARCHAR(100),
    @Email NVARCHAR(100),
    @Password NVARCHAR(255) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @UserId INT;
    SELECT @UserId = User_Id FROM Instructor WHERE Instructor_Id = @InstructorId;

    IF EXISTS (SELECT 1 FROM [User] WHERE User_Email = @Email AND User_Id <> @UserId)
    BEGIN
        THROW 51000, 'Email already exists.', 1;
    END

    UPDATE [User] 
    SET User_Name = @FullName, 
        User_Email = @Email,
        User_Password = ISNULL(@Password, User_Password)
    WHERE User_Id = @UserId;
END
GO`,
        },
        {
          id: 31,
          name: "sp_Admin_DeleteInstructor",
          category: "admin",
          summary: "Removes instructor and user account",
          purpose:
            "Permanently removes an instructor and their associated user account from the system. This operation deletes instructor credentials while considering the impact on associated courses and exams.",
          parameters: "@InstructorId (INT): Instructor_Id to delete",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "Instructor, User",
          validations:
            "Deletion is permanent and cannot be undone; Both Instructor and User records deleted in single transaction; May fail if instructor has active courses or created exams",
          usageExample: "EXEC sp_Admin_DeleteInstructor @InstructorId = 25;",
          notes:
            "May fail if instructor has created courses or exams. Consider reassigning courses before deletion. User_Id lookup ensures correct user account deleted.",
          errorHandling: "Transaction rollback if either delete fails",
          code: `CREATE OR ALTER PROCEDURE sp_Admin_DeleteInstructor
    @InstructorId INT
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @UserId INT;
    SELECT @UserId = User_Id FROM Instructor WHERE Instructor_Id = @InstructorId;

    BEGIN TRANSACTION;
        DELETE FROM Instructor WHERE Instructor_Id = @InstructorId;
        DELETE FROM [User] WHERE User_Id = @UserId;
    COMMIT TRANSACTION;
END
GO`,
        },
        {
          id: 32,
          name: "sp_Admin_AddCourse",
          category: "admin",
          summary: "Creates new course with retry limit",
          purpose:
            "Creates a new course in the system with specified retry limit. Courses are fundamental entities that can be assigned to tracks and have exams created for them.",
          parameters:
            "@CourseName (NVARCHAR(100)): Name of the course, @TriesLimit (INT): Maximum exam attempts allowed for this course",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "Course",
          validations:
            "Course name should be descriptive and unique (not enforced); Tries limit determines how many times students can retake exams; Course_Id auto-generated for subsequent relationships",
          usageExample: `EXEC sp_Admin_AddCourse 
    @CourseName = 'Advanced SQL Programming',
    @TriesLimit = 3;`,
          notes:
            "Simple single-table insert operation. No transaction needed for atomic operation. Course becomes available immediately after creation.",
          errorHandling: "Relies on database constraints for validation",
          code: `CREATE OR ALTER PROCEDURE sp_Admin_AddCourse
    @CourseName NVARCHAR(100),
    @TriesLimit INT
AS
BEGIN
    INSERT INTO Course (Course_Name, Tries_Limit) VALUES (@CourseName, @TriesLimit);
END
GO`,
        },
        {
          id: 33,
          name: "sp_Admin_UpdateCourse",
          category: "admin",
          summary: "Updates course name and retry limit",
          purpose:
            "Updates existing course information including name and retry limit. Allows modification of course parameters while maintaining existing relationships with tracks and exams.",
          parameters:
            "@CourseId (INT): Course_Id to update, @CourseName (NVARCHAR(100)): Updated course name, @TriesLimit (INT): Updated maximum attempt limit",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "Course",
          validations:
            "Changes affect all associated exams and tracks; Tries limit change doesn't retroactively affect completed exams; Course_Id remains unchanged",
          usageExample: `EXEC sp_Admin_UpdateCourse 
    @CourseId = 15,
    @CourseName = 'Advanced SQL Programming & Optimization',
    @TriesLimit = 5;`,
          notes:
            "Simple single-table update. No transaction needed. Changes visible immediately to all users.",
          errorHandling: "Implicit validation that Course_Id exists",
          code: `CREATE OR ALTER PROCEDURE sp_Admin_UpdateCourse
    @CourseId INT,
    @CourseName NVARCHAR(100),
    @TriesLimit INT
AS
BEGIN
    UPDATE Course 
    SET Course_Name = @CourseName, Tries_Limit = @TriesLimit 
    WHERE Course_Id = @CourseId;
END
GO`,
        },
        {
          id: 34,
          name: "sp_Admin_DeleteCourse",
          category: "admin",
          summary: "Removes course from system",
          purpose:
            "Permanently removes a course from the system. This is a destructive operation that may cascade to related exams, questions, and track assignments.",
          parameters: "@CourseId (INT): Course_Id to delete",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "Course",
          validations:
            "Deletion is permanent and cannot be undone; May cascade delete to Exam, Question, Track_Course tables; Cannot delete if foreign key constraints prevent it",
          usageExample: "EXEC sp_Admin_DeleteCourse @CourseId = 15;",
          notes:
            "Consider impact before deletion. May affect multiple students and tracks. No archive or backup mechanism.",
          errorHandling: "Foreign key constraints may prevent deletion",
          code: `CREATE OR ALTER PROCEDURE sp_Admin_DeleteCourse
    @CourseId INT
AS
BEGIN
    DELETE FROM Course WHERE Course_Id = @CourseId;
END
GO`,
        },
        {
          id: 35,
          name: "sp_Admin_AddBranch",
          category: "admin",
          summary: "Creates new ITI branch location",
          purpose:
            "Creates a new ITI branch location in the system. Branches represent physical locations where students are enrolled and classes are conducted.",
          parameters:
            "@BranchName (NVARCHAR(100)): Name of the branch, @BranchLocation (NVARCHAR(100)): Physical location/address of branch",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "Branch",
          validations:
            "Branch name should be unique (not enforced); Location provides geographical context; Branch_Id auto-generated for student assignments",
          usageExample: `EXEC sp_Admin_AddBranch 
    @BranchName = 'New Cairo Branch',
    @BranchLocation = 'Cairo, New Cairo, 5th Settlement';`,
          notes:
            "Simple single-table insert. No validation of location format. Branch becomes available immediately.",
          errorHandling: "Relies on database constraints",
          code: `CREATE OR ALTER PROCEDURE sp_Admin_AddBranch
    @BranchName NVARCHAR(100),
    @BranchLocation NVARCHAR(100)
AS
BEGIN
    INSERT INTO Branch (Branch_Name, Branch_Location) VALUES (@BranchName, @BranchLocation);
END
GO`,
        },
        {
          id: 36,
          name: "sp_Admin_UpdateBranch",
          category: "admin",
          summary: "Updates branch name and location",
          purpose:
            "Updates existing branch information including name and location. Allows modification of branch details while maintaining student assignments.",
          parameters:
            "@BranchId (INT): Branch_Id to update, @BranchName (NVARCHAR(100)): Updated branch name, @BranchLocation (NVARCHAR(100)): Updated location/address",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "Branch",
          validations:
            "Changes affect all students assigned to branch; Branch_Id remains unchanged; Updates don't affect historical data",
          usageExample: `EXEC sp_Admin_UpdateBranch 
    @BranchId = 3,
    @BranchName = 'Smart Village Campus',
    @BranchLocation = 'Giza, Smart Village, Building 5';`,
          notes:
            "Simple single-table update. Changes visible immediately. Students remain associated with branch.",
          errorHandling: "Implicit validation that Branch_Id exists",
          code: `CREATE OR ALTER PROCEDURE sp_Admin_UpdateBranch
    @BranchId INT,
    @BranchName NVARCHAR(100),
    @BranchLocation NVARCHAR(100)
AS
BEGIN
    UPDATE Branch 
    SET Branch_Name = @BranchName, Branch_Location = @BranchLocation 
    WHERE Branch_Id = @BranchId;
END
GO`,
        },
        {
          id: 37,
          name: "sp_Admin_DeleteBranch",
          category: "admin",
          summary: "Removes branch from system",
          purpose:
            "Permanently removes a branch from the system. This operation affects all students currently assigned to the branch.",
          parameters: "@BranchId (INT): Branch_Id to delete",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "Branch",
          validations:
            "Deletion is permanent; Cannot delete if students are assigned to branch; Foreign key constraints prevent deletion with dependencies",
          usageExample: "EXEC sp_Admin_DeleteBranch @BranchId = 3;",
          notes:
            "Will fail if any students assigned to branch. No cascade delete to students. No archive mechanism.",
          errorHandling:
            "Foreign key constraints prevent deletion if students assigned",
          code: `CREATE OR ALTER PROCEDURE sp_Admin_DeleteBranch
    @BranchId INT
AS
BEGIN
    DELETE FROM Branch WHERE Branch_Id = @BranchId;
END
GO`,
        },
        {
          id: 38,
          name: "sp_Admin_AddTrack",
          category: "admin",
          summary: "Creates new study track",
          purpose:
            "Creates a new study track in the ITI system. Tracks represent specialized programs of study (e.g., .NET, Java, UI/UX) that group related courses.",
          parameters: "@TrackName (NVARCHAR(100)): Name of the track",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "Track",
          validations:
            "Track name should be unique (not enforced); Track_Id auto-generated for student and course assignments; Tracks can be assigned to multiple branches",
          usageExample:
            "EXEC sp_Admin_AddTrack @TrackName = 'Full Stack JavaScript (MEAN)';",
          notes:
            "Minimal track information stored. No course assignments at creation. Track becomes available immediately.",
          errorHandling: "Relies on database constraints",
          code: `CREATE OR ALTER PROCEDURE sp_Admin_AddTrack 
    @TrackName NVARCHAR(100)
AS
BEGIN
    INSERT INTO Track (Track_Name) VALUES (@TrackName);
END
GO`,
        },
        {
          id: 39,
          name: "sp_Admin_UpdateTrack",
          category: "admin",
          summary: "Updates track name",
          purpose:
            "Updates existing track information. Currently only supports track name updates but maintains all existing student and course relationships.",
          parameters:
            "@TrackId (INT): Track_Id to update, @TrackName (NVARCHAR(100)): Updated track name",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "Track",
          validations:
            "Changes affect all students enrolled in track; Track_Id remains unchanged; Course assignments remain intact",
          usageExample: `EXEC sp_Admin_UpdateTrack 
    @TrackId = 5,
    @TrackName = 'Full Stack JavaScript (MERN)';`,
          notes:
            "Simple single-table update. Changes visible immediately to all users. Students and courses remain associated.",
          errorHandling: "Implicit validation that Track_Id exists",
          code: `CREATE OR ALTER PROCEDURE sp_Admin_UpdateTrack 
    @TrackId INT, 
    @TrackName NVARCHAR(100)
AS
BEGIN
    UPDATE Track SET Track_Name = @TrackName WHERE Track_Id = @TrackId;
END
GO`,
        },
        {
          id: 40,
          name: "sp_Admin_DeleteTrack",
          category: "admin",
          summary: "Removes track from system",
          purpose:
            "Permanently removes a track from the system. This is a destructive operation that affects all students enrolled in the track and their course assignments.",
          parameters: "@TrackId (INT): Track_Id to delete",
          returns: "None (operation success/failure via error handling)",
          tablesModified: "Track",
          validations:
            "Deletion is permanent and cannot be undone; Cannot delete if students are enrolled in track; May cascade to Track_Course junction table",
          usageExample: "EXEC sp_Admin_DeleteTrack @TrackId = 5;",
          notes:
            "Will fail if any students assigned to track. May fail if courses assigned to track. No cascade delete to students.",
          errorHandling:
            "Foreign key constraints prevent deletion if students enrolled",
          code: `CREATE OR ALTER PROCEDURE sp_Admin_DeleteTrack 
    @TrackId INT
AS
BEGIN
    DELETE FROM Track WHERE Track_Id = @TrackId;
END
GO`,
        },
      ];

      // Initialize the application
      document.addEventListener("DOMContentLoaded", function () {
        // Initialize sidebar procedures list
        renderProcedureList();

        // Initialize procedure content sections
        renderProcedureSections();

        // Initialize quick navigation
        renderQuickNavigation();

        // Set up event listeners
        setupEventListeners();

        // Highlight code blocks
        hljs.highlightAll();

        // Show welcome content by default
        showProcedureContent("welcome");

        // Add initial animation for stats cards
        animateStatsCards();
      });

      // Animate stats cards on load
      function animateStatsCards() {
        const statsCards = document.querySelectorAll(".stat-card");
        statsCards.forEach((card, index) => {
          card.style.animationDelay = `${index * 0.1}s`;
          card.classList.add("floating");
        });
      }

      // Render the procedure list in the sidebar
      function renderProcedureList() {
        const procedureList = document.getElementById("procedureList");
        procedureList.innerHTML = "";

        procedures.forEach((proc) => {
          const procItem = document.createElement("div");
          procItem.className = `procedure-item ${proc.category}`;
          procItem.dataset.id = proc.id;

          procItem.innerHTML = `
                    <span class="procedure-id">#${proc.id}</span>
                    <span class="procedure-name">${proc.name}</span>
                `;

          procedureList.appendChild(procItem);
        });
      }

      // Render quick navigation
      function renderQuickNavigation() {
        const quickNav = document.getElementById("quickNav");
        quickNav.innerHTML = "";

        procedures.forEach((proc) => {
          const navItem = document.createElement("div");
          navItem.className = `nav-item ${proc.category}`;
          navItem.dataset.id = proc.id;

          navItem.innerHTML = `
                    <span class="nav-item-id">#${proc.id}</span>
                    <strong>${proc.name}</strong><br>
                    <small>${proc.summary}</small>
                `;

          quickNav.appendChild(navItem);
        });
      }

      // Render procedure content sections
      function renderProcedureSections() {
        const container = document.getElementById("proceduresContainer");

        procedures.forEach((proc) => {
          const section = document.createElement("div");
          section.className = `procedure-section`;
          section.id = `procedure-${proc.id}`;

          // Create parameter table if needed
          let parametersTable = "";
          if (proc.parameters && proc.parameters !== "None") {
            parametersTable = `
                        <div class="content-section">
                            <h3>Parameters</h3>
                            <table class="parameters-table">
                                <thead>
                                    <tr>
                                        <th>Parameter</th>
                                        <th>Type</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${createParameterRows(proc.parameters)}
                                </tbody>
                            </table>
                        </div>
                    `;
          }

          // Create returns table if needed
          let returnsTable = "";
          if (proc.returns && !proc.returns.includes("None")) {
            returnsTable = `
                        <div class="content-section">
                            <h3>Returns</h3>
                            <table class="returns-table">
                                <thead>
                                    <tr>
                                        <th>Column</th>
                                        <th>Type</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${createReturnRows(proc.returns)}
                                </tbody>
                            </table>
                        </div>
                    `;
          }

          // Create validations section if needed
          let validationsSection = "";
          if (proc.validations) {
            validationsSection = `
                        <div class="content-section">
                            <h3>Validations</h3>
                            <ul>
                                ${createListItems(proc.validations)}
                            </ul>
                        </div>
                    `;
          }

          // Create errors section if needed
          let errorsSection = "";
          if (proc.errorsThrown) {
            errorsSection = `
                        <div class="content-section">
                            <h3>Errors Thrown</h3>
                            <ul>
                                ${createListItems(proc.errorsThrown)}
                            </ul>
                        </div>
                    `;
          }

          // Create tables section if needed
          let tablesSection = "";
          if (proc.tablesAccessed) {
            tablesSection = `
                        <div class="content-section">
                            <h3>Tables Accessed</h3>
                            <p>${proc.tablesAccessed}</p>
                        </div>
                    `;
          } else if (proc.tablesModified) {
            tablesSection = `
                        <div class="content-section">
                            <h3>Tables Modified</h3>
                            <p>${proc.tablesModified}</p>
                        </div>
                    `;
          }

          section.innerHTML = `
                    <div class="procedure-header">
                        <div class="procedure-title">
                            <h2>${proc.name}</h2>
                            <p>${proc.summary}</p>
                            <div class="procedure-meta">
                                <div class="meta-item">
                                    <i class="fas fa-hashtag"></i>
                                    <span>ID: ${proc.id}</span>
                                </div>
                                <div class="meta-item">
                                    <i class="fas fa-tag"></i>
                                    <span>Category: <span class="procedure-category ${proc.category}">${proc.category.toUpperCase()}</span></span>
                                </div>
                                <div class="meta-item">
                                    <i class="fas fa-user-tag"></i>
                                    <span>Role: ${getRoleFromCategory(proc.category)}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="procedure-content">
                        <div class="content-section">
                            <h3>Purpose</h3>
                            <p>${proc.purpose}</p>
                        </div>
                        
                        ${parametersTable}
                        ${returnsTable}
                        ${tablesSection}
                        ${validationsSection}
                        ${errorsSection}
                        
                        <div class="content-section">
                            <h3>Usage Example</h3>
                            <div class="code-block">
                                <div class="code-header">
                                    <span>SQL</span>
                                    <button class="copy-btn" data-code="${escapeHtml(proc.usageExample)}">
                                        <i class="far fa-copy"></i> Copy
                                    </button>
                                </div>
                                <pre><code class="language-sql">${proc.usageExample}</code></pre>
                            </div>
                        </div>
                        
                        <div class="content-section">
                            <h3>Notes</h3>
                            <p>${proc.notes}</p>
                        </div>
                        
                        <div class="content-section">
                            <h3>Error Handling</h3>
                            <p>${proc.errorHandling}</p>
                        </div>
                        
                        <div class="content-section">
                            <h3>Procedure Code</h3>
                            <div class="code-block">
                                <div class="code-header">
                                    <span>SQL</span>
                                    <button class="copy-btn" data-code="${escapeHtml(proc.code)}">
                                        <i class="far fa-copy"></i> Copy
                                    </button>
                                </div>
                                <pre><code class="language-sql">${proc.code}</code></pre>
                            </div>
                        </div>
                    </div>
                `;

          container.appendChild(section);
        });
      }

      // Helper function to get role from category
      function getRoleFromCategory(category) {
        switch (category) {
          case "admin":
            return "Administrator";
          case "student":
            return "Student";
          case "instructor":
            return "Instructor";
          case "auth":
            return "Authentication";
          case "exam":
            return "Exam Management";
          default:
            return "System";
        }
      }

      // Helper function to create parameter table rows
      function createParameterRows(parametersText) {
        if (!parametersText || parametersText === "None") return "";

        const params = parametersText.split(", ");
        let rows = "";

        params.forEach((param) => {
          const match = param.match(/(@\w+)\s*\(([^)]+)\)(?:\s*:\s*(.+))?/);
          if (match) {
            const [, name, type, description] = match;
            rows += `
                        <tr>
                            <td><code>${name}</code></td>
                            <td><code>${type}</code></td>
                            <td>${description || ""}</td>
                        </tr>
                    `;
          } else {
            rows += `
                        <tr>
                            <td colspan="3">${param}</td>
                        </tr>
                    `;
          }
        });

        return rows;
      }

      // Helper function to create return table rows
      function createReturnRows(returnsText) {
        if (!returnsText || returnsText.includes("None")) return "";

        const returns = returnsText.split("; ");
        let rows = "";

        returns.forEach((ret) => {
          const match = ret.match(/(\w+)\s*\(([^)]+)\)(?:\s*:\s*(.+))?/);
          if (match) {
            const [, column, type, description] = match;
            rows += `
                        <tr>
                            <td><code>${column}</code></td>
                            <td><code>${type}</code></td>
                            <td>${description || ""}</td>
                        </tr>
                    `;
          }
        });

        return rows;
      }

      // Helper function to create list items from text
      function createListItems(text) {
        if (!text) return "";

        const items = text.split("; ");
        let listItems = "";

        items.forEach((item) => {
          if (item.trim()) {
            listItems += `<li>${item.trim()}</li>`;
          }
        });

        return listItems;
      }

      // Helper function to escape HTML
      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // Set up event listeners
      function setupEventListeners() {
        // Category filter buttons
        const categoryBtns = document.querySelectorAll(".category-btn");
        categoryBtns.forEach((btn) => {
          btn.addEventListener("click", function () {
            categoryBtns.forEach((b) => b.classList.remove("active"));
            this.classList.add("active");

            const category = this.dataset.category;
            filterProcedures(category);
          });
        });

        // Procedure items in sidebar
        document.addEventListener("click", function (e) {
          const procedureItem = e.target.closest(".procedure-item");
          if (procedureItem) {
            const procId = procedureItem.dataset.id;
            selectProcedure(procId);
          }

          // Quick nav items
          const navItem = e.target.closest(".nav-item");
          if (navItem) {
            const procId = navItem.dataset.id;
            selectProcedure(procId);
          }
        });

        // Search input
        const searchInput = document.getElementById("searchInput");
        searchInput.addEventListener("input", function () {
          const searchTerm = this.value.toLowerCase();
          filterProceduresBySearch(searchTerm);
        });

        // Copy code buttons
        document.addEventListener("click", function (e) {
          if (e.target.closest(".copy-btn")) {
            const copyBtn = e.target.closest(".copy-btn");
            const code = copyBtn.dataset.code;

            navigator.clipboard.writeText(code).then(() => {
              const originalText = copyBtn.innerHTML;
              copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
              copyBtn.style.background =
                "linear-gradient(135deg, #10b981, #22c55e)";

              setTimeout(() => {
                copyBtn.innerHTML = originalText;
                copyBtn.style.background =
                  "linear-gradient(135deg, #0ea5e9, #3b82f6)";
              }, 2000);
            });
          }
        });

        // Mobile toggle button
        const mobileToggle = document.getElementById("mobileToggle");
        mobileToggle.addEventListener("click", function () {
          const sidebar = document.getElementById("sidebar");
          sidebar.classList.toggle("open");

          const icon = this.querySelector("i");
          if (sidebar.classList.contains("open")) {
            icon.className = "fas fa-times";
          } else {
            icon.className = "fas fa-bars";
          }
        });

        // Close sidebar when clicking outside on mobile
        document.addEventListener("click", function (e) {
          const sidebar = document.getElementById("sidebar");
          const mobileToggle = document.getElementById("mobileToggle");

          if (
            window.innerWidth <= 1024 &&
            !sidebar.contains(e.target) &&
            !mobileToggle.contains(e.target) &&
            sidebar.classList.contains("open")
          ) {
            sidebar.classList.remove("open");
            mobileToggle.querySelector("i").className = "fas fa-bars";
          }
        });

        // Add hover effect to copy buttons
        document.addEventListener("mouseover", function (e) {
          if (e.target.closest(".copy-btn")) {
            e.target.closest(".copy-btn").classList.add("glow");
          }
        });

        document.addEventListener("mouseout", function (e) {
          if (e.target.closest(".copy-btn")) {
            e.target.closest(".copy-btn").classList.remove("glow");
          }
        });
      }

      // Select a procedure (common function for both sidebar and quick nav)
      function selectProcedure(procId) {
        // Remove active class from all procedure items
        document
          .querySelectorAll(".procedure-item, .nav-item")
          .forEach((item) => {
            item.classList.remove("active");
          });

        // Add active class to clicked item
        const procItem = document.querySelector(
          `.procedure-item[data-id="${procId}"]`,
        );
        const navItem = document.querySelector(
          `.nav-item[data-id="${procId}"]`,
        );

        if (procItem) procItem.classList.add("active");
        if (navItem) navItem.classList.add("active");

        // Show the procedure content
        showProcedureContent(procId);

        // Close sidebar on mobile
        if (window.innerWidth <= 1024) {
          document.getElementById("sidebar").classList.remove("open");
          document.getElementById("mobileToggle").querySelector("i").className =
            "fas fa-bars";
        }
      }

      // Filter procedures by category
      function filterProcedures(category) {
        const procedureItems = document.querySelectorAll(".procedure-item");
        const navItems = document.querySelectorAll(".nav-item");
        const searchInput = document.getElementById("searchInput");

        searchInput.value = "";

        if (category === "all") {
          procedureItems.forEach((item) => (item.style.display = "block"));
          navItems.forEach((item) => (item.style.display = "block"));
        } else {
          procedureItems.forEach((item) => {
            if (item.classList.contains(category)) {
              item.style.display = "block";
            } else {
              item.style.display = "none";
            }
          });

          navItems.forEach((item) => {
            if (item.classList.contains(category)) {
              item.style.display = "block";
            } else {
              item.style.display = "none";
            }
          });
        }

        if (
          category !== "all" &&
          document.getElementById("welcomeContent").classList.contains("active")
        ) {
          const firstVisible = document.querySelector(
            `.procedure-item.${category}[style*="block"]`,
          );
          if (firstVisible) {
            selectProcedure(firstVisible.dataset.id);
          }
        }
      }

      // Filter procedures by search term
      function filterProceduresBySearch(searchTerm) {
        const procedureItems = document.querySelectorAll(".procedure-item");
        const navItems = document.querySelectorAll(".nav-item");
        const activeCategory = document.querySelector(".category-btn.active")
          .dataset.category;

        procedureItems.forEach((item) => {
          const procName = item
            .querySelector(".procedure-name")
            .textContent.toLowerCase();
          const procId = item
            .querySelector(".procedure-id")
            .textContent.toLowerCase();

          const matchesSearch =
            procName.includes(searchTerm) || procId.includes(searchTerm);
          const matchesCategory =
            activeCategory === "all" || item.classList.contains(activeCategory);

          item.style.display =
            matchesSearch && matchesCategory ? "block" : "none";
        });

        navItems.forEach((item) => {
          const text = item.textContent.toLowerCase();
          const matchesSearch = text.includes(searchTerm);
          const matchesCategory =
            activeCategory === "all" || item.classList.contains(activeCategory);

          item.style.display =
            matchesSearch && matchesCategory ? "block" : "none";
        });

        if (
          searchTerm &&
          document.getElementById("welcomeContent").classList.contains("active")
        ) {
          const firstVisible = document.querySelector(
            '.procedure-item[style*="block"]',
          );
          if (firstVisible) {
            selectProcedure(firstVisible.dataset.id);
          }
        }
      }

      // Show procedure content
      function showProcedureContent(procId) {
        document.querySelectorAll(".procedure-section").forEach((section) => {
          section.classList.remove("active");
        });

        if (procId === "welcome") {
          document.getElementById("welcomeContent").classList.add("active");
        } else {
          document
            .getElementById(`procedure-${procId}`)
            .classList.add("active");
        }

        hljs.highlightAll();
        document.querySelector(".main-content").scrollTo({
          top: 0,
          behavior: "smooth",
        });
      }
    </script>
  </body>
</html>
